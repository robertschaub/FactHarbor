{
  "evalId": "eval-e3p-2026-01-26T06:23:03",
  "results": {
    "version": 3,
    "timestamp": "2026-01-26T06:23:03.909Z",
    "prompts": [
      {
        "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
        "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
        "id": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "provider": "Claude Haiku",
        "metrics": {
          "score": 7,
          "testPassCount": 7,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 25,
          "assertFailCount": 0,
          "totalLatencyMs": 113,
          "tokenUsage": {
            "prompt": 0,
            "completion": 0,
            "cached": 14081,
            "total": 14081,
            "numRequests": 7,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {
            "score_in_reliable_range": 1,
            "correct_rating": 4,
            "correct_source_type": 3,
            "score_capped_correctly": 1,
            "adequate_confidence": 1,
            "score_capped_at_042": 1,
            "score_capped_at_014": 1,
            "null_score": 1,
            "insufficient_data_rating": 1,
            "low_confidence": 1,
            "score_not_penalized_for_bias": 1,
            "bias_noted": 1,
            "evidence_cited_correctly": 1
          },
          "namedScoresCount": {
            "score_in_reliable_range": 1,
            "correct_rating": 4,
            "correct_source_type": 3,
            "score_capped_correctly": 1,
            "adequate_confidence": 1,
            "score_capped_at_042": 1,
            "score_capped_at_014": 1,
            "null_score": 1,
            "insufficient_data_rating": 1,
            "low_confidence": 1,
            "score_not_penalized_for_bias": 1,
            "bias_noted": 1,
            "evidence_cited_correctly": 1
          },
          "cost": 0.018320799999999998
        }
      },
      {
        "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
        "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
        "id": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "provider": "GPT-4o",
        "metrics": {
          "score": 7,
          "testPassCount": 7,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 25,
          "assertFailCount": 0,
          "totalLatencyMs": 31087,
          "tokenUsage": {
            "prompt": 0,
            "completion": 0,
            "cached": 12370,
            "total": 12370,
            "numRequests": 7,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {
            "score_in_reliable_range": 1,
            "correct_rating": 4,
            "correct_source_type": 3,
            "score_capped_correctly": 1,
            "adequate_confidence": 1,
            "score_capped_at_042": 1,
            "score_capped_at_014": 1,
            "null_score": 1,
            "insufficient_data_rating": 1,
            "low_confidence": 1,
            "score_not_penalized_for_bias": 1,
            "bias_noted": 1,
            "evidence_cited_correctly": 1
          },
          "namedScoresCount": {
            "score_in_reliable_range": 1,
            "correct_rating": 4,
            "correct_source_type": 3,
            "score_capped_correctly": 1,
            "adequate_confidence": 1,
            "score_capped_at_042": 1,
            "score_capped_at_014": 1,
            "null_score": 1,
            "insufficient_data_rating": 1,
            "low_confidence": 1,
            "score_not_penalized_for_bias": 1,
            "bias_noted": 1,
            "evidence_cited_correctly": 1
          },
          "cost": 0.04899250000000001
        }
      }
    ],
    "results": [
      {
        "cost": 0.0026184,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "score_in_reliable_range": 1,
            "correct_rating": 1,
            "correct_source_type": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score >= 0.72 && data.score <= 1.0;\n",
                "metric": "score_in_reliable_range"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn [\"highly_reliable\", \"reliable\"].includes(data.factualRating);\n",
                "metric": "correct_rating"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"wire_service\" || data.sourceType === \"editorial_publisher\";\n",
                "metric": "correct_source_type"
              }
            }
          ]
        },
        "id": "ad7450d2-32b5-4a98-8884-b286abbdbbd5",
        "latencyMs": 27,
        "namedScores": {
          "score_in_reliable_range": 1,
          "correct_rating": 1,
          "correct_source_type": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"example-wire-service.com\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Uses credible sources and proper sourcing. Minor fails over time but corrects promptly.\n[E2] Wikipedia Reliable Sources: Described as \"generally reliable\" with strong editorial standards.\n[E3] NewsGuard: 95/100 rating. Adheres to basic standards of credibility and transparency.\n[E4] AllSides: Center bias rating. Known for balanced coverage.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 0,
        "provider": {
          "id": "anthropic:claude-3-5-haiku-20241022",
          "label": "Claude Haiku"
        },
        "response": {
          "output": "{\n\"sourceType\": \"wire_service\",\n\"identifiedEntity\": null,\n\"evidenceQuality\": {\n\"independentAssessmentsCount\": 3,\n\"recencyWindowUsed\": \"2024-2026\",\n\"notes\": \"Multiple independent assessments available\"\n},\n\"score\": 0.82,\n\"confidence\": 0.85,\n\"factualRating\": \"reliable\",\n\"bias\": {\n\"politicalBias\": \"center\",\n\"otherBias\": null\n},\n\"reasoning\": \"Multiple high-quality independent assessments indicate strong factual reporting standards. NewsGuard, Media Bias/Fact Check, and Wikipedia Reliable Sources all provide positive evaluations of the source's credibility and accuracy.\",\n\"evidenceCited\": [\n{\n\"claim\": \"High factual reporting standards with credible sourcing\",\n\"basis\": \"E1\",\n\"recency\": \"2024-2026\"\n},\n{\n\"claim\": \"Generally reliable with strong editorial standards\",\n\"basis\": \"E2\", \n\"recency\": \"2024-2026\"\n},\n{\n\"claim\": \"High credibility rating with transparency\",\n\"basis\": \"E3\",\n\"recency\": \"2024-2026\"\n}\n],\n\"caveats\": [\"Minor corrections noted over time\"]\n}",
          "tokenUsage": {
            "cached": 2025,
            "total": 2025
          },
          "finishReason": "stop",
          "cost": 0.0026184,
          "cached": true
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Reliable wire service with multiple fact-checker endorsements",
          "vars": {
            "domain": "example-wire-service.com",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Uses credible sources and proper sourcing. Minor fails over time but corrects promptly.\n[E2] Wikipedia Reliable Sources: Described as \"generally reliable\" with strong editorial standards.\n[E3] NewsGuard: 95/100 rating. Adheres to basic standards of credibility and transparency.\n[E4] AllSides: Center bias rating. Known for balanced coverage.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score >= 0.72 && data.score <= 1.0;\n",
              "metric": "score_in_reliable_range"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn [\"highly_reliable\", \"reliable\"].includes(data.factualRating);\n",
              "metric": "correct_rating"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"wire_service\" || data.sourceType === \"editorial_publisher\";\n",
              "metric": "correct_source_type"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "domain": "example-wire-service.com",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Uses credible sources and proper sourcing. Minor fails over time but corrects promptly.\n[E2] Wikipedia Reliable Sources: Described as \"generally reliable\" with strong editorial standards.\n[E3] NewsGuard: 95/100 rating. Adheres to basic standards of credibility and transparency.\n[E4] AllSides: Center bias rating. Known for balanced coverage.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0069500000000000004,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "score_in_reliable_range": 1,
            "correct_rating": 1,
            "correct_source_type": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score >= 0.72 && data.score <= 1.0;\n",
                "metric": "score_in_reliable_range"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn [\"highly_reliable\", \"reliable\"].includes(data.factualRating);\n",
                "metric": "correct_rating"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"wire_service\" || data.sourceType === \"editorial_publisher\";\n",
                "metric": "correct_source_type"
              }
            }
          ]
        },
        "id": "c0a4c5d5-e328-4dfc-bd29-49b4ab3ccf15",
        "latencyMs": 3499,
        "namedScores": {
          "score_in_reliable_range": 1,
          "correct_rating": 1,
          "correct_source_type": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"example-wire-service.com\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Uses credible sources and proper sourcing. Minor fails over time but corrects promptly.\n[E2] Wikipedia Reliable Sources: Described as \"generally reliable\" with strong editorial standards.\n[E3] NewsGuard: 95/100 rating. Adheres to basic standards of credibility and transparency.\n[E4] AllSides: Center bias rating. Known for balanced coverage.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4o",
          "label": "GPT-4o"
        },
        "response": {
          "output": "{\n  \"sourceType\": \"wire_service\",\n  \"identifiedEntity\": null,\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": 3,\n    \"recencyWindowUsed\": \"2024-2026\",\n    \"notes\": \"The source has multiple independent assessments with consistent high ratings.\"\n  },\n  \"score\": 0.95,\n  \"confidence\": 1.0,\n  \"factualRating\": \"highly_reliable\",\n  \"bias\": {\n    \"politicalBias\": \"center\",\n    \"otherBias\": \"none_detected\"\n  },\n  \"reasoning\": \"The source 'example-wire-service.com' is highly rated by Media Bias/Fact Check (E1), Wikipedia Reliable Sources (E2), and NewsGuard (E3), indicating strong editorial standards and factual reporting. All evidence is recent, within the last two years, and there is a consensus among independent assessments. There are no significant negative factors affecting the reliability score.\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"Rated HIGH for factual reporting by Media Bias/Fact Check.\",\n      \"basis\": \"E1\",\n      \"recency\": \"Current\"\n    },\n    {\n      \"claim\": \"Described as 'generally reliable' by Wikipedia Reliable Sources.\",\n      \"basis\": \"E2\",\n      \"recency\": \"Current\"\n    },\n    {\n      \"claim\": \"Received a 95/100 rating from NewsGuard.\",\n      \"basis\": \"E3\",\n      \"recency\": \"Current\"\n    }\n  ],\n  \"caveats\": []\n}",
          "tokenUsage": {
            "cached": 1772,
            "total": 1772
          },
          "cached": true,
          "latencyMs": 3499,
          "finishReason": "stop",
          "cost": 0.0069500000000000004,
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Reliable wire service with multiple fact-checker endorsements",
          "vars": {
            "domain": "example-wire-service.com",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Uses credible sources and proper sourcing. Minor fails over time but corrects promptly.\n[E2] Wikipedia Reliable Sources: Described as \"generally reliable\" with strong editorial standards.\n[E3] NewsGuard: 95/100 rating. Adheres to basic standards of credibility and transparency.\n[E4] AllSides: Center bias rating. Known for balanced coverage.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score >= 0.72 && data.score <= 1.0;\n",
              "metric": "score_in_reliable_range"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn [\"highly_reliable\", \"reliable\"].includes(data.factualRating);\n",
              "metric": "correct_rating"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"wire_service\" || data.sourceType === \"editorial_publisher\";\n",
              "metric": "correct_source_type"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "domain": "example-wire-service.com",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Uses credible sources and proper sourcing. Minor fails over time but corrects promptly.\n[E2] Wikipedia Reliable Sources: Described as \"generally reliable\" with strong editorial standards.\n[E3] NewsGuard: 95/100 rating. Adheres to basic standards of credibility and transparency.\n[E4] AllSides: Center bias rating. Known for balanced coverage.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0028016,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "score_capped_correctly": 1,
            "correct_rating": 1,
            "adequate_confidence": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.0 && data.score <= 0.42;\n",
                "metric": "score_capped_correctly"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn [\"unreliable\", \"leaning_unreliable\", \"highly_unreliable\"].includes(data.factualRating);\n",
                "metric": "correct_rating"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.confidence >= 0.50;\n",
                "metric": "adequate_confidence"
              }
            }
          ]
        },
        "id": "5f711a2a-010a-40ef-ae81-28f8f935d040",
        "latencyMs": 28,
        "namedScores": {
          "score_capped_correctly": 1,
          "correct_rating": 1,
          "adequate_confidence": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"example-tabloid.net\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] PolitiFact (IFCN signatory, last 6 months): 8 claims reviewed, 6 rated False or Mostly False. Published fabricated quotes attributed to government officials.\n[E2] Snopes (IFCN signatory, last 12 months): Documented 5 instances of misleading headlines that directly contradict article content. Pattern of clickbait misinformation.\n[E3] Media Bias/Fact Check (current): Rated LOW for factual reporting. Failed 12 fact-checks in past 2 years. Questionable sources cited.\n[E4] NewsGuard (current): 35/100 rating. Fails to gather and present information responsibly. Does not regularly correct errors.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 0,
        "provider": {
          "id": "anthropic:claude-3-5-haiku-20241022",
          "label": "Claude Haiku"
        },
        "response": {
          "output": "{\n\"sourceType\": \"unknown\",\n\"identifiedEntity\": null,\n\"evidenceQuality\": {\n\"independentAssessmentsCount\": 3,\n\"recencyWindowUsed\": \"2024-2026\",\n\"notes\": \"Multiple independent fact-checkers evaluated source\"\n},\n\"score\": 0.25,\n\"confidence\": 0.55,\n\"factualRating\": \"unreliable\",\n\"bias\": {\n\"politicalBias\": \"not_applicable\",\n\"otherBias\": \"sensationalist\"\n},\n\"reasoning\": \"Multiple independent fact-checkers documented systematic misinformation and fabrication. Source consistently fails basic journalistic standards with fabricated quotes, misleading headlines, and repeated factual errors.\",\n\"evidenceCited\": [\n{\n\"claim\": \"Published fabricated government official quotes\",\n\"basis\": \"E1\",\n\"recency\": \"last 6 months\"\n},\n{\n\"claim\": \"Documented misleading headlines contradicting article content\",\n\"basis\": \"E2\",\n\"recency\": \"last 12 months\"\n},\n{\n\"claim\": \"Failed multiple fact-checks with questionable sources\",\n\"basis\": \"E3\",\n\"recency\": \"current\"\n},\n{\n\"claim\": \"Low rating for responsible information gathering\",\n\"basis\": \"E4\",\n\"recency\": \"current\"\n}\n],\n\"caveats\": [\"Evidence suggests consistent pattern of misinformation\"]\n}",
          "tokenUsage": {
            "cached": 2122,
            "total": 2122
          },
          "finishReason": "stop",
          "cost": 0.0028016,
          "cached": true
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Source with multiple documented fact-check failures",
          "vars": {
            "domain": "example-tabloid.net",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] PolitiFact (IFCN signatory, last 6 months): 8 claims reviewed, 6 rated False or Mostly False. Published fabricated quotes attributed to government officials.\n[E2] Snopes (IFCN signatory, last 12 months): Documented 5 instances of misleading headlines that directly contradict article content. Pattern of clickbait misinformation.\n[E3] Media Bias/Fact Check (current): Rated LOW for factual reporting. Failed 12 fact-checks in past 2 years. Questionable sources cited.\n[E4] NewsGuard (current): 35/100 rating. Fails to gather and present information responsibly. Does not regularly correct errors.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.0 && data.score <= 0.42;\n",
              "metric": "score_capped_correctly"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn [\"unreliable\", \"leaning_unreliable\", \"highly_unreliable\"].includes(data.factualRating);\n",
              "metric": "correct_rating"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.confidence >= 0.50;\n",
              "metric": "adequate_confidence"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "domain": "example-tabloid.net",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] PolitiFact (IFCN signatory, last 6 months): 8 claims reviewed, 6 rated False or Mostly False. Published fabricated quotes attributed to government officials.\n[E2] Snopes (IFCN signatory, last 12 months): Documented 5 instances of misleading headlines that directly contradict article content. Pattern of clickbait misinformation.\n[E3] Media Bias/Fact Check (current): Rated LOW for factual reporting. Failed 12 fact-checks in past 2 years. Questionable sources cited.\n[E4] NewsGuard (current): 35/100 rating. Fails to gather and present information responsibly. Does not regularly correct errors.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.007815,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "score_capped_correctly": 1,
            "correct_rating": 1,
            "adequate_confidence": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.0 && data.score <= 0.42;\n",
                "metric": "score_capped_correctly"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn [\"unreliable\", \"leaning_unreliable\", \"highly_unreliable\"].includes(data.factualRating);\n",
                "metric": "correct_rating"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.confidence >= 0.50;\n",
                "metric": "adequate_confidence"
              }
            }
          ]
        },
        "id": "37383581-a215-40e5-abd3-3ad71ca77f0b",
        "latencyMs": 5253,
        "namedScores": {
          "score_capped_correctly": 1,
          "correct_rating": 1,
          "adequate_confidence": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"example-tabloid.net\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] PolitiFact (IFCN signatory, last 6 months): 8 claims reviewed, 6 rated False or Mostly False. Published fabricated quotes attributed to government officials.\n[E2] Snopes (IFCN signatory, last 12 months): Documented 5 instances of misleading headlines that directly contradict article content. Pattern of clickbait misinformation.\n[E3] Media Bias/Fact Check (current): Rated LOW for factual reporting. Failed 12 fact-checks in past 2 years. Questionable sources cited.\n[E4] NewsGuard (current): 35/100 rating. Fails to gather and present information responsibly. Does not regularly correct errors.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4o",
          "label": "GPT-4o"
        },
        "response": {
          "output": "{\n  \"sourceType\": \"known_disinformation\",\n  \"identifiedEntity\": null,\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": 4,\n    \"recencyWindowUsed\": \"2024-2026\",\n    \"notes\": \"Multiple fact-checks by independent and credible organizations indicate consistent patterns of misinformation and disinformation.\"\n  },\n  \"score\": 0.14,\n  \"confidence\": 0.80,\n  \"factualRating\": \"highly_unreliable\",\n  \"bias\": {\n    \"politicalBias\": \"null\",\n    \"otherBias\": \"sensationalist\"\n  },\n  \"reasoning\": \"The source 'example-tabloid.net' has been consistently identified as unreliable by multiple independent assessments (E1, E2, E3, E4). It frequently publishes false information and misleading content, as corroborated by various fact-checking organizations. This pattern of behavior aligns with the characteristics of known disinformation sources.\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"8 claims reviewed, 6 rated False or Mostly False.\",\n      \"basis\": \"E1\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"5 instances of misleading headlines.\",\n      \"basis\": \"E2\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"Failed 12 fact-checks in past 2 years.\",\n      \"basis\": \"E3\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"35/100 rating on NewsGuard.\",\n      \"basis\": \"E4\",\n      \"recency\": \"2024-2026\"\n    }\n  ],\n  \"caveats\": [\n    \"The analysis assumes no significant change in source behavior outside the evidenced timeframe.\",\n    \"Potential unknown improvements or editorial changes in the future might warrant re-evaluation.\"\n  ]\n}",
          "tokenUsage": {
            "cached": 1896,
            "total": 1896
          },
          "cached": true,
          "latencyMs": 5253,
          "finishReason": "stop",
          "cost": 0.007815,
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Source with multiple documented fact-check failures",
          "vars": {
            "domain": "example-tabloid.net",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] PolitiFact (IFCN signatory, last 6 months): 8 claims reviewed, 6 rated False or Mostly False. Published fabricated quotes attributed to government officials.\n[E2] Snopes (IFCN signatory, last 12 months): Documented 5 instances of misleading headlines that directly contradict article content. Pattern of clickbait misinformation.\n[E3] Media Bias/Fact Check (current): Rated LOW for factual reporting. Failed 12 fact-checks in past 2 years. Questionable sources cited.\n[E4] NewsGuard (current): 35/100 rating. Fails to gather and present information responsibly. Does not regularly correct errors.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.0 && data.score <= 0.42;\n",
              "metric": "score_capped_correctly"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn [\"unreliable\", \"leaning_unreliable\", \"highly_unreliable\"].includes(data.factualRating);\n",
              "metric": "correct_rating"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.confidence >= 0.50;\n",
              "metric": "adequate_confidence"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "domain": "example-tabloid.net",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] PolitiFact (IFCN signatory, last 6 months): 8 claims reviewed, 6 rated False or Mostly False. Published fabricated quotes attributed to government officials.\n[E2] Snopes (IFCN signatory, last 12 months): Documented 5 instances of misleading headlines that directly contradict article content. Pattern of clickbait misinformation.\n[E3] Media Bias/Fact Check (current): Rated LOW for factual reporting. Failed 12 fact-checks in past 2 years. Questionable sources cited.\n[E4] NewsGuard (current): 35/100 rating. Fails to gather and present information responsibly. Does not regularly correct errors.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0026472,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "correct_source_type": 1,
            "score_capped_at_042": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"state_controlled_media\";\n",
                "metric": "correct_source_type"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.42;\n",
                "metric": "score_capped_at_042"
              }
            }
          ]
        },
        "id": "ada16baf-b6f5-4d93-afa0-569b0a281535",
        "latencyMs": 16,
        "namedScores": {
          "correct_source_type": 1,
          "score_capped_at_042": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"state-news-agency.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Reporters Without Borders: Classified as state-controlled media. No editorial independence from government.\n[E2] EU DisinfoLab: Content consistently reflects government narratives without critical coverage.\n[E3] Freedom House: Media outlet directly controlled by Ministry of Information.\n[E4] Academic study (last 18 months): Analysis shows 98% alignment with official government positions.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 0,
        "provider": {
          "id": "anthropic:claude-3-5-haiku-20241022",
          "label": "Claude Haiku"
        },
        "response": {
          "output": "{\n\"sourceType\": \"state_controlled_media\",\n\"identifiedEntity\": null,\n\"evidenceQuality\": {\n\"independentAssessmentsCount\": 3,\n\"recencyWindowUsed\": \"2024-2026\",\n\"notes\": \"Multiple independent assessments available\"\n},\n\"score\": 0.35,\n\"confidence\": 0.55,\n\"factualRating\": \"leaning_unreliable\",\n\"bias\": {\n\"politicalBias\": \"center\",\n\"otherBias\": \"pro_government\"\n},\n\"reasoning\": \"The source is directly controlled by government authorities with extremely high alignment to official narratives. Multiple independent assessments confirm lack of editorial independence and consistent government messaging.\",\n\"evidenceCited\": [\n{\n\"claim\": \"State-controlled media with no editorial independence\",\n\"basis\": \"E1, E3\",\n\"recency\": \"2024-2026\"\n},\n{\n\"claim\": \"98% alignment with government positions\",\n\"basis\": \"E4\",\n\"recency\": \"2024-2026\"\n},\n{\n\"claim\": \"Consistently reflects government narratives\",\n\"basis\": \"E2\",\n\"recency\": \"2024-2026\"\n}\n],\n\"caveats\": [\n\"Direct government control limits journalistic independence\",\n\"High risk of narrative manipulation\"\n]\n}",
          "tokenUsage": {
            "cached": 2017,
            "total": 2017
          },
          "finishReason": "stop",
          "cost": 0.0026472,
          "cached": true
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "State-controlled media outlet - score must be capped",
          "vars": {
            "domain": "state-news-agency.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Reporters Without Borders: Classified as state-controlled media. No editorial independence from government.\n[E2] EU DisinfoLab: Content consistently reflects government narratives without critical coverage.\n[E3] Freedom House: Media outlet directly controlled by Ministry of Information.\n[E4] Academic study (last 18 months): Analysis shows 98% alignment with official government positions.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"state_controlled_media\";\n",
              "metric": "correct_source_type"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.42;\n",
              "metric": "score_capped_at_042"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "domain": "state-news-agency.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Reporters Without Borders: Classified as state-controlled media. No editorial independence from government.\n[E2] EU DisinfoLab: Content consistently reflects government narratives without critical coverage.\n[E3] Freedom House: Media outlet directly controlled by Ministry of Information.\n[E4] Academic study (last 18 months): Analysis shows 98% alignment with official government positions.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0068275,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "correct_source_type": 1,
            "score_capped_at_042": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"state_controlled_media\";\n",
                "metric": "correct_source_type"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.42;\n",
                "metric": "score_capped_at_042"
              }
            }
          ]
        },
        "id": "9e0cde29-f237-499d-9e08-f3754132adbe",
        "latencyMs": 4054,
        "namedScores": {
          "correct_source_type": 1,
          "score_capped_at_042": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"state-news-agency.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Reporters Without Borders: Classified as state-controlled media. No editorial independence from government.\n[E2] EU DisinfoLab: Content consistently reflects government narratives without critical coverage.\n[E3] Freedom House: Media outlet directly controlled by Ministry of Information.\n[E4] Academic study (last 18 months): Analysis shows 98% alignment with official government positions.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4o",
          "label": "GPT-4o"
        },
        "response": {
          "output": "{\n  \"sourceType\": \"state_controlled_media\",\n  \"identifiedEntity\": \"state-news-agency.example\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": 3,\n    \"recencyWindowUsed\": \"2024-2026\",\n    \"notes\": \"Consistent classification as state-controlled with no editorial independence.\"\n  },\n  \"score\": 0.42,\n  \"confidence\": 0.70,\n  \"factualRating\": \"mixed\",\n  \"bias\": {\n    \"politicalBias\": \"not_applicable\",\n    \"otherBias\": \"pro_government\"\n  },\n  \"reasoning\": \"The source is classified as state-controlled media and is subject to editorial control by the government (E1, E3). Reports indicate a consistent alignment with government narratives, and the evidence is recent and consistent (E2, E4). Despite this, the source is limited by a source type cap due to its control status.\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"Classified as state-controlled media with no editorial independence.\",\n      \"basis\": \"E1, E3\",\n      \"recency\": \"recent\"\n    },\n    {\n      \"claim\": \"Content consistently aligns with government narratives.\",\n      \"basis\": \"E2, E4\",\n      \"recency\": \"recent\"\n    }\n  ],\n  \"caveats\": [\n    \"The reliability is capped due to being state-controlled media.\",\n    \"No strong evidence of outright fabrication or disinformation was presented, only alignment with government positions.\"\n  ]\n}",
          "tokenUsage": {
            "cached": 1750,
            "total": 1750
          },
          "cached": true,
          "latencyMs": 4054,
          "finishReason": "stop",
          "cost": 0.0068275,
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "State-controlled media outlet - score must be capped",
          "vars": {
            "domain": "state-news-agency.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Reporters Without Borders: Classified as state-controlled media. No editorial independence from government.\n[E2] EU DisinfoLab: Content consistently reflects government narratives without critical coverage.\n[E3] Freedom House: Media outlet directly controlled by Ministry of Information.\n[E4] Academic study (last 18 months): Analysis shows 98% alignment with official government positions.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"state_controlled_media\";\n",
              "metric": "correct_source_type"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.42;\n",
              "metric": "score_capped_at_042"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "domain": "state-news-agency.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Reporters Without Borders: Classified as state-controlled media. No editorial independence from government.\n[E2] EU DisinfoLab: Content consistently reflects government narratives without critical coverage.\n[E3] Freedom House: Media outlet directly controlled by Ministry of Information.\n[E4] Academic study (last 18 months): Analysis shows 98% alignment with official government positions.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0028200000000000005,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "correct_source_type": 1,
            "score_capped_at_014": 1,
            "correct_rating": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"propaganda_outlet\" || data.sourceType === \"known_disinformation\";\n",
                "metric": "correct_source_type"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.14;\n",
                "metric": "score_capped_at_014"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"highly_unreliable\";\n",
                "metric": "correct_rating"
              }
            }
          ]
        },
        "id": "ca1f4f29-f248-4376-9629-5bfec7554e1d",
        "latencyMs": 14,
        "namedScores": {
          "correct_source_type": 1,
          "score_capped_at_014": 1,
          "correct_rating": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"propaganda-network.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] EU EUvsDisinfo: Listed in database of pro-Kremlin disinformation outlets.\n[E2] US State Department: Identified as part of coordinated influence operation.\n[E3] Stanford Internet Observatory: Documented as amplifying state propaganda narratives.\n[E4] NewsGuard: 0/100 rating. Publishes false content and does not disclose ownership.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 0,
        "provider": {
          "id": "anthropic:claude-3-5-haiku-20241022",
          "label": "Claude Haiku"
        },
        "response": {
          "output": "{\n\"sourceType\": \"propaganda_outlet\",\n\"identifiedEntity\": null,\n\"evidenceQuality\": {\n\"independentAssessmentsCount\": 3,\n\"recencyWindowUsed\": \"2024-2026\",\n\"notes\": \"Multiple independent assessments from reputable sources\"\n},\n\"score\": 0.14,\n\"confidence\": 0.55,\n\"factualRating\": \"highly_unreliable\",\n\"bias\": {\n\"politicalBias\": \"not_applicable\",\n\"otherBias\": \"pro_government\"\n},\n\"reasoning\": \"Multiple authoritative sources have identified this outlet as part of a coordinated disinformation network. The source is systematically spreading false narratives and lacks credibility.\",\n\"evidenceCited\": [\n{\n\"claim\": \"Listed in pro-Kremlin disinformation database\",\n\"basis\": \"E1\",\n\"recency\": \"2026-01-25\"\n},\n{\n\"claim\": \"Part of coordinated influence operation\",\n\"basis\": \"E2\",\n\"recency\": \"2026-01-25\"\n},\n{\n\"claim\": \"Amplifies state propaganda narratives\",\n\"basis\": \"E3\",\n\"recency\": \"2026-01-25\"\n},\n{\n\"claim\": \"Zero credibility rating from NewsGuard\",\n\"basis\": \"E4\",\n\"recency\": \"2026-01-25\"\n}\n],\n\"caveats\": [\"Source type automatically capped at 0.14 due to propaganda classification\"]\n}",
          "tokenUsage": {
            "cached": 2061,
            "total": 2061
          },
          "finishReason": "stop",
          "cost": 0.0028200000000000005,
          "cached": true
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Known propaganda outlet - score must be capped at 0.14",
          "vars": {
            "domain": "propaganda-network.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] EU EUvsDisinfo: Listed in database of pro-Kremlin disinformation outlets.\n[E2] US State Department: Identified as part of coordinated influence operation.\n[E3] Stanford Internet Observatory: Documented as amplifying state propaganda narratives.\n[E4] NewsGuard: 0/100 rating. Publishes false content and does not disclose ownership.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"propaganda_outlet\" || data.sourceType === \"known_disinformation\";\n",
              "metric": "correct_source_type"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.14;\n",
              "metric": "score_capped_at_014"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"highly_unreliable\";\n",
              "metric": "correct_rating"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "domain": "propaganda-network.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] EU EUvsDisinfo: Listed in database of pro-Kremlin disinformation outlets.\n[E2] US State Department: Identified as part of coordinated influence operation.\n[E3] Stanford Internet Observatory: Documented as amplifying state propaganda narratives.\n[E4] NewsGuard: 0/100 rating. Publishes false content and does not disclose ownership.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.007367500000000001,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "correct_source_type": 1,
            "score_capped_at_014": 1,
            "correct_rating": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"propaganda_outlet\" || data.sourceType === \"known_disinformation\";\n",
                "metric": "correct_source_type"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.14;\n",
                "metric": "score_capped_at_014"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"highly_unreliable\";\n",
                "metric": "correct_rating"
              }
            }
          ]
        },
        "id": "3f4698a5-7f30-46ce-841f-0a7f1945c4bc",
        "latencyMs": 3715,
        "namedScores": {
          "correct_source_type": 1,
          "score_capped_at_014": 1,
          "correct_rating": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"propaganda-network.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] EU EUvsDisinfo: Listed in database of pro-Kremlin disinformation outlets.\n[E2] US State Department: Identified as part of coordinated influence operation.\n[E3] Stanford Internet Observatory: Documented as amplifying state propaganda narratives.\n[E4] NewsGuard: 0/100 rating. Publishes false content and does not disclose ownership.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4o",
          "label": "GPT-4o"
        },
        "response": {
          "output": "{\n  \"sourceType\": \"propaganda_outlet\",\n  \"identifiedEntity\": \"propaganda-network.example\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": 4,\n    \"recencyWindowUsed\": \"2024-2026\",\n    \"notes\": \"Multiple independent sources confirm the site's role in disinformation.\"\n  },\n  \"score\": 0.14,\n  \"confidence\": 0.80,\n  \"factualRating\": \"highly_unreliable\",\n  \"bias\": {\n    \"politicalBias\": \"not_applicable\",\n    \"otherBias\": \"pro_government\"\n  },\n  \"reasoning\": \"The source is identified by multiple independent organizations as part of a coordinated influence operation and publishes false content, justifying a rating of highly unreliable. Since it is characterized as a propaganda outlet, score is capped at 0.14.\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"Listed in database of pro-Kremlin disinformation outlets.\",\n      \"basis\": \"E1\",\n      \"recency\": \"2024\"\n    },\n    {\n      \"claim\": \"Identified as part of coordinated influence operation.\",\n      \"basis\": \"E2\",\n      \"recency\": \"2024\"\n    },\n    {\n      \"claim\": \"Documented as amplifying state propaganda narratives.\",\n      \"basis\": \"E3\",\n      \"recency\": \"2024\"\n    },\n    {\n      \"claim\": \"Publishes false content and does not disclose ownership.\",\n      \"basis\": \"E4\",\n      \"recency\": \"2024\"\n    }\n  ],\n  \"caveats\": [\n    \"All evidence aligns with the recent recency window and suggests consistent patterns.\",\n    \"Independent verification is limited to known reports; no current refutations are available.\"\n  ]\n}",
          "tokenUsage": {
            "cached": 1804,
            "total": 1804
          },
          "cached": true,
          "latencyMs": 3715,
          "finishReason": "stop",
          "cost": 0.007367500000000001,
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Known propaganda outlet - score must be capped at 0.14",
          "vars": {
            "domain": "propaganda-network.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] EU EUvsDisinfo: Listed in database of pro-Kremlin disinformation outlets.\n[E2] US State Department: Identified as part of coordinated influence operation.\n[E3] Stanford Internet Observatory: Documented as amplifying state propaganda narratives.\n[E4] NewsGuard: 0/100 rating. Publishes false content and does not disclose ownership.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"propaganda_outlet\" || data.sourceType === \"known_disinformation\";\n",
              "metric": "correct_source_type"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.14;\n",
              "metric": "score_capped_at_014"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"highly_unreliable\";\n",
              "metric": "correct_rating"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "domain": "propaganda-network.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] EU EUvsDisinfo: Listed in database of pro-Kremlin disinformation outlets.\n[E2] US State Department: Identified as part of coordinated influence operation.\n[E3] Stanford Internet Observatory: Documented as amplifying state propaganda narratives.\n[E4] NewsGuard: 0/100 rating. Publishes false content and does not disclose ownership.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0022376,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "null_score": 1,
            "insufficient_data_rating": 1,
            "low_confidence": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score === null;\n",
                "metric": "null_score"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"insufficient_data\";\n",
                "metric": "insufficient_data_rating"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.confidence < 0.50;\n",
                "metric": "low_confidence"
              }
            }
          ]
        },
        "id": "94c2ce59-41fd-4ff6-b1b1-105c3c6c78a4",
        "latencyMs": 11,
        "namedScores": {
          "null_score": 1,
          "insufficient_data_rating": 1,
          "low_confidence": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"unknown-local-blog.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Directory listing: Small local blog, no additional information available.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 0,
        "provider": {
          "id": "anthropic:claude-3-5-haiku-20241022",
          "label": "Claude Haiku"
        },
        "response": {
          "output": "{\n\"sourceType\": \"unknown\",\n\"identifiedEntity\": null,\n\"evidenceQuality\": {\n\"independentAssessmentsCount\": 0,\n\"recencyWindowUsed\": null,\n\"notes\": \"Extremely limited information available\"\n},\n\"score\": null,\n\"confidence\": 0.40,\n\"factualRating\": \"insufficient_data\",\n\"bias\": {\n\"politicalBias\": null,\n\"otherBias\": null\n},\n\"reasoning\": \"Insufficient evidence exists to evaluate the reliability of this local blog. The single directory listing provides no substantive information about the source's accuracy, editorial standards, or content quality.\",\n\"evidenceCited\": [\n{\n\"claim\": \"Small local blog with no additional context\",\n\"basis\": \"E1\",\n\"recency\": null\n}\n],\n\"caveats\": [\n\"No independent assessments available\",\n\"No content quality indicators present\",\n\"Insufficient data to make a meaningful reliability determination\"\n]\n}",
          "tokenUsage": {
            "cached": 1857,
            "total": 1857
          },
          "finishReason": "stop",
          "cost": 0.0022376,
          "cached": true
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Unknown source with sparse evidence - should return insufficient_data",
          "vars": {
            "domain": "unknown-local-blog.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Directory listing: Small local blog, no additional information available.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score === null;\n",
              "metric": "null_score"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"insufficient_data\";\n",
              "metric": "insufficient_data_rating"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.confidence < 0.50;\n",
              "metric": "low_confidence"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "domain": "unknown-local-blog.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Directory listing: Small local blog, no additional information available.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.005817500000000001,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "null_score": 1,
            "insufficient_data_rating": 1,
            "low_confidence": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score === null;\n",
                "metric": "null_score"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"insufficient_data\";\n",
                "metric": "insufficient_data_rating"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.confidence < 0.50;\n",
                "metric": "low_confidence"
              }
            }
          ]
        },
        "id": "c344476e-a207-478f-bd53-cd48a6e05f20",
        "latencyMs": 4632,
        "namedScores": {
          "null_score": 1,
          "insufficient_data_rating": 1,
          "low_confidence": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"unknown-local-blog.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Directory listing: Small local blog, no additional information available.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4o",
          "label": "GPT-4o"
        },
        "response": {
          "output": "{\n  \"sourceType\": \"unknown\",\n  \"identifiedEntity\": null,\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": 0,\n    \"recencyWindowUsed\": \"2024-2026\",\n    \"notes\": \"No independent assessments available about this source.\"\n  },\n  \"score\": null,\n  \"confidence\": 0.40,\n  \"factualRating\": \"insufficient_data\",\n  \"bias\": {\n    \"politicalBias\": \"null\",\n    \"otherBias\": null\n  },\n  \"reasoning\": \"The source 'unknown-local-blog.example' is a small local blog with no independent information or assessments provided. Without any additional evidence or fact-checks, it is impossible to accurately evaluate the reliability of this source.\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"Small local blog, no additional information available.\",\n      \"basis\": \"E1\",\n      \"recency\": \"N/A\"\n    }\n  ],\n  \"caveats\": [\n    \"Lack of independent verification prevents accurate assessment.\",\n    \"The blog's reliability cannot be determined based on the current evidence.\"\n  ]\n}",
          "tokenUsage": {
            "cached": 1604,
            "total": 1604
          },
          "cached": true,
          "latencyMs": 4632,
          "finishReason": "stop",
          "cost": 0.005817500000000001,
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Unknown source with sparse evidence - should return insufficient_data",
          "vars": {
            "domain": "unknown-local-blog.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Directory listing: Small local blog, no additional information available.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score === null;\n",
              "metric": "null_score"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"insufficient_data\";\n",
              "metric": "insufficient_data_rating"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.confidence < 0.50;\n",
              "metric": "low_confidence"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "domain": "unknown-local-blog.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Directory listing: Small local blog, no additional information available.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0027216000000000002,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "score_not_penalized_for_bias": 1,
            "bias_noted": 1,
            "correct_rating": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.58;\n",
                "metric": "score_not_penalized_for_bias"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.bias && data.bias.politicalBias !== \"center\";\n",
                "metric": "bias_noted"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn [\"reliable\", \"leaning_reliable\", \"highly_reliable\"].includes(data.factualRating);\n",
                "metric": "correct_rating"
              }
            }
          ]
        },
        "id": "2df33c52-436b-43ba-bac5-83050e1c0239",
        "latencyMs": 9,
        "namedScores": {
          "score_not_penalized_for_bias": 1,
          "bias_noted": 1,
          "correct_rating": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"partisan-news.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Strong left-center bias but accurate.\n[E2] AllSides: Left bias rating, but described as \"factually reliable\".\n[E3] NewsGuard: 82/100 rating. Gathers and presents information responsibly despite perspective.\n[E4] PolitiFact: Reviewed 20 claims in past 18 months, only 2 rated as misleading.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 0,
        "provider": {
          "id": "anthropic:claude-3-5-haiku-20241022",
          "label": "Claude Haiku"
        },
        "response": {
          "output": "{\n\"sourceType\": \"editorial_publisher\",\n\"identifiedEntity\": null,\n\"evidenceQuality\": {\n\"independentAssessmentsCount\": 3,\n\"recencyWindowUsed\": \"2024-2026\",\n\"notes\": \"Multiple independent assessments available\"\n},\n\"score\": 0.82,\n\"confidence\": 0.75,\n\"factualRating\": \"reliable\",\n\"bias\": {\n\"politicalBias\": \"left\",\n\"otherBias\": null\n},\n\"reasoning\": \"Multiple independent fact-checkers confirm high factual reliability. NewsGuard provides strong rating, Media Bias/Fact Check notes accuracy, and PolitiFact shows minimal misleading claims.\",\n\"evidenceCited\": [\n{\n\"claim\": \"High factual reporting standards\",\n\"basis\": \"E1\",\n\"recency\": \"2026-01-25\"\n},\n{\n\"claim\": \"Factually reliable despite left bias\",\n\"basis\": \"E2\",\n\"recency\": \"2026-01-25\"\n},\n{\n\"claim\": \"Responsible information gathering\",\n\"basis\": \"E3\",\n\"recency\": \"2026-01-25\"\n},\n{\n\"claim\": \"Low rate of misleading claims\",\n\"basis\": \"E4\",\n\"recency\": \"2024-2025\"\n}\n],\n\"caveats\": [\"Left political bias present\"]\n}",
          "tokenUsage": {
            "cached": 2050,
            "total": 2050
          },
          "finishReason": "stop",
          "cost": 0.0027216000000000002,
          "cached": true
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Politically biased source with good accuracy - bias alone should not cap score",
          "vars": {
            "domain": "partisan-news.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Strong left-center bias but accurate.\n[E2] AllSides: Left bias rating, but described as \"factually reliable\".\n[E3] NewsGuard: 82/100 rating. Gathers and presents information responsibly despite perspective.\n[E4] PolitiFact: Reviewed 20 claims in past 18 months, only 2 rated as misleading.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.58;\n",
              "metric": "score_not_penalized_for_bias"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.bias && data.bias.politicalBias !== \"center\";\n",
              "metric": "bias_noted"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn [\"reliable\", \"leaning_reliable\", \"highly_reliable\"].includes(data.factualRating);\n",
              "metric": "correct_rating"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "domain": "partisan-news.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Strong left-center bias but accurate.\n[E2] AllSides: Left bias rating, but described as \"factually reliable\".\n[E3] NewsGuard: 82/100 rating. Gathers and presents information responsibly despite perspective.\n[E4] PolitiFact: Reviewed 20 claims in past 18 months, only 2 rated as misleading.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0074825000000000004,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "score_not_penalized_for_bias": 1,
            "bias_noted": 1,
            "correct_rating": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.58;\n",
                "metric": "score_not_penalized_for_bias"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn data.bias && data.bias.politicalBias !== \"center\";\n",
                "metric": "bias_noted"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nreturn [\"reliable\", \"leaning_reliable\", \"highly_reliable\"].includes(data.factualRating);\n",
                "metric": "correct_rating"
              }
            }
          ]
        },
        "id": "c8151b3b-7430-409d-b877-ea6446ff60b0",
        "latencyMs": 3850,
        "namedScores": {
          "score_not_penalized_for_bias": 1,
          "bias_noted": 1,
          "correct_rating": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"partisan-news.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Strong left-center bias but accurate.\n[E2] AllSides: Left bias rating, but described as \"factually reliable\".\n[E3] NewsGuard: 82/100 rating. Gathers and presents information responsibly despite perspective.\n[E4] PolitiFact: Reviewed 20 claims in past 18 months, only 2 rated as misleading.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4o",
          "label": "GPT-4o"
        },
        "response": {
          "output": "{\n  \"sourceType\": \"editorial_publisher\",\n  \"identifiedEntity\": \"partisan-news.example\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": 4,\n    \"recencyWindowUsed\": \"2024-2026\",\n    \"notes\": \"High factual reporting ratings from multiple independent assessments with recent verification.\"\n  },\n  \"score\": 0.86,\n  \"confidence\": 0.85,\n  \"factualRating\": \"reliable\",\n  \"bias\": {\n    \"politicalBias\": \"left\",\n    \"otherBias\": \"ideological_other\"\n  },\n  \"reasoning\": \"Partisan-news.example is consistently rated as factually reliable by multiple independent fact-checks (E1, E2, E3, E4). Most evidence is recent, with no significant contradictions found in the assessments. Despite a strong left bias, the source maintains high standards of factual reporting and accuracy.\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"Rated HIGH for factual reporting.\",\n      \"basis\": \"E1\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"Left bias, but factually reliable.\",\n      \"basis\": \"E2\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"82/100 score, responsible information presentation.\",\n      \"basis\": \"E3\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"2 misleading claims out of 20 reviewed.\",\n      \"basis\": \"E4\",\n      \"recency\": \"2024-2026\"\n    }\n  ],\n  \"caveats\": [\n    \"Political bias is present but does not affect factual reliability.\",\n    \"The assessments indicate ideological leanings but affirm strong editorial standards.\"\n  ]\n}",
          "tokenUsage": {
            "cached": 1823,
            "total": 1823
          },
          "cached": true,
          "latencyMs": 3850,
          "finishReason": "stop",
          "cost": 0.0074825000000000004,
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "Politically biased source with good accuracy - bias alone should not cap score",
          "vars": {
            "domain": "partisan-news.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Strong left-center bias but accurate.\n[E2] AllSides: Left bias rating, but described as \"factually reliable\".\n[E3] NewsGuard: 82/100 rating. Gathers and presents information responsibly despite perspective.\n[E4] PolitiFact: Reviewed 20 claims in past 18 months, only 2 rated as misleading.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.58;\n",
              "metric": "score_not_penalized_for_bias"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn data.bias && data.bias.politicalBias !== \"center\";\n",
              "metric": "bias_noted"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nreturn [\"reliable\", \"leaning_reliable\", \"highly_reliable\"].includes(data.factualRating);\n",
              "metric": "correct_rating"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "domain": "partisan-news.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Strong left-center bias but accurate.\n[E2] AllSides: Left bias rating, but described as \"factually reliable\".\n[E3] NewsGuard: 82/100 rating. Gathers and presents information responsibly despite perspective.\n[E4] PolitiFact: Reviewed 20 claims in past 18 months, only 2 rated as misleading.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0024744,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "evidence_cited_correctly": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nif (!data.evidenceCited || data.evidenceCited.length === 0) return false;\nreturn data.evidenceCited.every(e => /E\\d+/.test(e.basis));\n",
                "metric": "evidence_cited_correctly"
              }
            }
          ]
        },
        "id": "219e0901-5d7d-4bfd-a06e-9d8128f121a3",
        "latencyMs": 8,
        "namedScores": {
          "evidence_cited_correctly": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"test-citation-source.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Fact-checker A: Rates source as generally reliable with good editorial standards.\n[E2] Fact-checker B: Confirms accurate reporting in recent review.\n[E3] Academic analysis: Source cited frequently in peer-reviewed research.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 0,
        "provider": {
          "id": "anthropic:claude-3-5-haiku-20241022",
          "label": "Claude Haiku"
        },
        "response": {
          "output": "{\n\"sourceType\": \"editorial_publisher\",\n\"identifiedEntity\": null,\n\"evidenceQuality\": {\n\"independentAssessmentsCount\": 2,\n\"recencyWindowUsed\": \"2024-2026\",\n\"notes\": \"Multiple independent fact-checker assessments\"\n},\n\"score\": 0.80,\n\"confidence\": 0.75,\n\"factualRating\": \"reliable\",\n\"bias\": {\n\"politicalBias\": \"center\",\n\"otherBias\": null\n},\n\"reasoning\": \"Source demonstrates strong reliability through multiple independent fact-checker assessments. Academic citations suggest credible reporting standards. No significant negative evidence was identified.\",\n\"evidenceCited\": [\n{\n\"claim\": \"Fact-checker A rates source as generally reliable\",\n\"basis\": \"E1\",\n\"recency\": \"2026\"\n},\n{\n\"claim\": \"Fact-checker B confirms accurate reporting\",\n\"basis\": \"E2\", \n\"recency\": \"2026\"\n},\n{\n\"claim\": \"Source frequently cited in peer-reviewed research\",\n\"basis\": \"E3\",\n\"recency\": \"2026\"\n}\n],\n\"caveats\": []\n}",
          "tokenUsage": {
            "cached": 1949,
            "total": 1949
          },
          "finishReason": "stop",
          "cost": 0.0024744,
          "cached": true
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "All claims must cite evidence IDs (E1, E2, etc.)",
          "vars": {
            "domain": "test-citation-source.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Fact-checker A: Rates source as generally reliable with good editorial standards.\n[E2] Fact-checker B: Confirms accurate reporting in recent review.\n[E3] Academic analysis: Source cited frequently in peer-reviewed research.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nif (!data.evidenceCited || data.evidenceCited.length === 0) return false;\nreturn data.evidenceCited.every(e => /E\\d+/.test(e.basis));\n",
              "metric": "evidence_cited_correctly"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "domain": "test-citation-source.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Fact-checker A: Rates source as generally reliable with good editorial standards.\n[E2] Fact-checker B: Confirms accurate reporting in recent review.\n[E3] Academic analysis: Source cited frequently in peer-reviewed research.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.006732500000000001,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {
            "evidence_cited_correctly": 1
          },
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "const data = JSON.parse(output);\nif (!data.evidenceCited || data.evidenceCited.length === 0) return false;\nreturn data.evidenceCited.every(e => /E\\d+/.test(e.basis));\n",
                "metric": "evidence_cited_correctly"
              }
            }
          ]
        },
        "id": "9246a54c-fdec-4d1c-ae9c-04c04111b709",
        "latencyMs": 6084,
        "namedScores": {
          "evidence_cited_correctly": 1
        },
        "prompt": {
          "raw": "You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"test-citation-source.example\" (evaluation date: 2026-01-25).\n\n## EVIDENCE PACK\n[E1] Fact-checker A: Rates source as generally reliable with good editorial standards.\n[E2] Fact-checker B: Confirms accurate reporting in recent review.\n[E3] Academic analysis: Source cited frequently in peer-reviewed research.\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "label": "apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt: You are a media reliability analyst using EVIDENCE-ONLY methodology.\n\nCRITICAL RULES:\n(1) Evaluate sources based solely on PROVIDED EVIDENCE - cite evidence pack items (E1, E2, etc.) for every claim.\n(2) Apply SOURCE TYPE CAPS: propaganda_outlet/known_disinformation → ≤14%, state_controlled_media/platform_ugc → ≤42%.\n(3) Apply negative evidence caps: fabrication/disinformation → ≤14%, 3+ failures → ≤42%, 1-2 failures → ≤57%.\n(4) Never use pretrained knowledge about sources.\n(5) Self-published pages (source's own website) do NOT count as independent assessments.\n(6) Default to insufficient_data when evidence is sparse (confidence < 0.50).\n(7) Separate political bias from accuracy - bias alone does not reduce score.\n\nTASK: Evaluate source reliability for \"{{domain}}\" (evaluation date: {{currentDate}}).\n\n## EVIDENCE PACK\n{{evidencePack}}\n\n═══════════════════════════════════════════════════════════════════\nRATING SCALE (score → factualRating — MUST match exactly)\n═══════════════════════════════════════════════════════════════════\n  0.86–1.00 → highly_reliable     (highest standards, fact-checked, proactively corrects)\n  0.72–0.85 → reliable            (good standards, accurate, corrects promptly)\n  0.58–0.71 → leaning_reliable    (basic standards, mostly accurate, corrects when notified)\n  0.43–0.57 → mixed               (mixed standards, mixed accuracy, mixed corrections)\n  0.29–0.42 → leaning_unreliable  (lax standards, often inaccurate, slow to correct)\n  0.15–0.28 → unreliable          (poor standards, inaccurate, rarely corrects)\n  0.00–0.14 → highly_unreliable   (lowest standards, fabricates, resists correction)\n  null      → insufficient_data   (cannot evaluate — sparse/no evidence)\n\n═══════════════════════════════════════════════════════════════════\nSOURCE TYPE CLASSIFICATION\n═══════════════════════════════════════════════════════════════════\n- editorial_publisher: Traditional news outlet with editorial oversight\n- wire_service: News agency providing content to other outlets\n- government: Official government communication\n- state_media: Government-FUNDED but editorially INDEPENDENT\n- state_controlled_media: Government DIRECTLY CONTROLS editorial decisions (CAPPED at 0.42)\n- platform_ugc: User-generated content platforms (CAPPED at 0.42)\n- advocacy: Organization promoting specific cause/viewpoint\n- aggregator: Republishes content from other sources\n- propaganda_outlet: PRIMARY PURPOSE is coordinated influence operations (CAPPED at 0.14)\n- known_disinformation: DOCUMENTED source of FABRICATED content (CAPPED at 0.14)\n- unknown: Cannot determine from evidence\n\n═══════════════════════════════════════════════════════════════════\nCONFIDENCE CALCULATION\n═══════════════════════════════════════════════════════════════════\nBase: 0.40\nADD:\n  +0.15 per independent fact-checker assessment (max +0.45 for 3+)\n  +0.10 if most evidence is within last 12 months\n  +0.10 if evidence shows consistent pattern (3+ sources agree)\nSUBTRACT:\n  -0.15 if evidence is contradictory/mixed signals\n  -0.10 if evidence is mostly >2 years old\n\nHow to compute (do NOT guess):\n1) confidence = 0.40\n2) confidence += 0.15 * min(independentAssessmentsCount, 3)\n3) add +0.10 for recency, +0.10 for consistency\n4) subtract penalties if applicable\n5) clamp to [0.0, 1.0]\nSanity check: If independentAssessmentsCount >= 3 AND evidence is recent AND consistent AND not contradictory,\nconfidence MUST be >= 0.70 (do not output < 0.50 in this case).\n\nTHRESHOLD: If confidence < 0.50, output score=null and factualRating=\"insufficient_data\"\n\n═══════════════════════════════════════════════════════════════════\nBIAS VALUES\n═══════════════════════════════════════════════════════════════════\npoliticalBias: far_left | left | center_left | center | center_right | right | far_right | not_applicable\notherBias: pro_government | anti_government | corporate_interest | sensationalist | ideological_other | none_detected | null\n\n═══════════════════════════════════════════════════════════════════\nOUTPUT FORMAT (RAW JSON ONLY - NO MARKDOWN CODE BLOCKS)\n═══════════════════════════════════════════════════════════════════\nIMPORTANT: Output ONLY the JSON object. Do NOT wrap in ```json or ``` markers.\nStart your response directly with { and end with }\n{\n  \"sourceType\": \"string (from list above)\",\n  \"identifiedEntity\": \"string OR null\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": \"number 0-10\",\n    \"recencyWindowUsed\": \"string, e.g. '2024-2026'\",\n    \"notes\": \"string\"\n  },\n  \"score\": \"number 0.0-1.0 OR null\",\n  \"confidence\": \"number 0.0-1.0\",\n  \"factualRating\": \"string (from rating scale)\",\n  \"bias\": {\n    \"politicalBias\": \"string\",\n    \"otherBias\": \"string OR null\"\n  },\n  \"reasoning\": \"string, 2-4 sentences\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"string\",\n      \"basis\": \"string, MUST cite evidence ID (E1, E2, etc.)\",\n      \"recency\": \"string\"\n    }\n  ],\n  \"caveats\": [\"string array\"]\n}\n\n═══════════════════════════════════════════════════════════════════\nVALIDATION CHECKLIST\n═══════════════════════════════════════════════════════════════════\n□ Score falls within correct range for factualRating\n□ Every claim in evidenceCited references an evidence ID (E1, E2, etc.)\n□ Applied SOURCE TYPE CAPS if applicable\n□ Applied negative evidence caps if applicable\n□ If confidence < 0.50 → considered insufficient_data\n□ Political bias noted but did NOT reduce score unless paired with documented failures\n□ Return only valid JSON",
          "config": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          }
        },
        "promptId": "4dcf4472b20d3b0fe066f780d3d038ff2324acd2e77b06516959b13dd878f332",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4o",
          "label": "GPT-4o"
        },
        "response": {
          "output": "{\n  \"sourceType\": \"editorial_publisher\",\n  \"identifiedEntity\": \"test-citation-source.example\",\n  \"evidenceQuality\": {\n    \"independentAssessmentsCount\": 3,\n    \"recencyWindowUsed\": \"2024-2026\",\n    \"notes\": \"Multiple independent assessments confirm reliability and frequent academic citation supports credibility.\"\n  },\n  \"score\": 0.86,\n  \"confidence\": 0.80,\n  \"factualRating\": \"highly_reliable\",\n  \"bias\": {\n    \"politicalBias\": \"not_applicable\",\n    \"otherBias\": \"none_detected\"\n  },\n  \"reasoning\": \"The source has been rated as reliable by multiple independent fact-checkers, and it is frequently cited in academic research, indicating a strong reputation for accuracy (E1, E2, E3). The evidence is recent and consistent.\",\n  \"evidenceCited\": [\n    {\n      \"claim\": \"The source is generally reliable with good editorial standards.\",\n      \"basis\": \"E1\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"The source's reporting was found to be accurate in a recent review.\",\n      \"basis\": \"E2\",\n      \"recency\": \"2024-2026\"\n    },\n    {\n      \"claim\": \"The source is frequently cited in peer-reviewed research.\",\n      \"basis\": \"E3\",\n      \"recency\": \"2024-2026\"\n    }\n  ],\n  \"caveats\": []\n}",
          "tokenUsage": {
            "cached": 1721,
            "total": 1721
          },
          "cached": true,
          "latencyMs": 6084,
          "finishReason": "stop",
          "cost": 0.006732500000000001,
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "All claims must cite evidence IDs (E1, E2, etc.)",
          "vars": {
            "domain": "test-citation-source.example",
            "currentDate": "2026-01-25",
            "evidencePack": "[E1] Fact-checker A: Rates source as generally reliable with good editorial standards.\n[E2] Fact-checker B: Confirms accurate reporting in recent review.\n[E3] Academic analysis: Source cited frequently in peer-reviewed research.\n"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "const data = JSON.parse(output);\nif (!data.evidenceCited || data.evidenceCited.length === 0) return false;\nreturn data.evidenceCited.every(e => /E\\d+/.test(e.basis));\n",
              "metric": "evidence_cited_correctly"
            }
          ],
          "options": {
            "timeout": 60000,
            "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "domain": "test-citation-source.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Fact-checker A: Rates source as generally reliable with good editorial standards.\n[E2] Fact-checker B: Confirms accurate reporting in recent review.\n[E3] Academic analysis: Source cited frequently in peer-reviewed research.\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      }
    ],
    "stats": {
      "successes": 14,
      "failures": 0,
      "errors": 0,
      "tokenUsage": {
        "prompt": 0,
        "completion": 0,
        "cached": 26451,
        "total": 26451,
        "numRequests": 14,
        "completionDetails": {
          "reasoning": 0,
          "acceptedPrediction": 0,
          "rejectedPrediction": 0
        },
        "assertions": {
          "total": 0,
          "prompt": 0,
          "completion": 0,
          "cached": 0,
          "numRequests": 0,
          "completionDetails": {
            "reasoning": 0,
            "acceptedPrediction": 0,
            "rejectedPrediction": 0
          }
        }
      },
      "durationMs": 227
    }
  },
  "config": {
    "tags": {},
    "description": "FactHarbor Source Reliability Evaluation",
    "prompts": [
      "file://C:\\DEV\\FactHarbor\\apps\\web\\prompts\\promptfoo\\source-reliability-prompt.txt"
    ],
    "providers": [
      {
        "id": "anthropic:claude-3-5-haiku-20241022",
        "label": "Claude Haiku",
        "config": {
          "temperature": 0
        },
        "transform": "// Remove markdown code fences if present\nlet cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
      },
      {
        "id": "openai:gpt-4o",
        "label": "GPT-4o",
        "config": {
          "temperature": 0
        },
        "transform": "// Remove markdown code fences if present\nlet cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
      }
    ],
    "tests": [
      {
        "description": "Reliable wire service with multiple fact-checker endorsements",
        "vars": {
          "domain": "example-wire-service.com",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Uses credible sources and proper sourcing. Minor fails over time but corrects promptly.\n[E2] Wikipedia Reliable Sources: Described as \"generally reliable\" with strong editorial standards.\n[E3] NewsGuard: 95/100 rating. Adheres to basic standards of credibility and transparency.\n[E4] AllSides: Center bias rating. Known for balanced coverage.\n"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.score >= 0.72 && data.score <= 1.0;\n",
            "metric": "score_in_reliable_range"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn [\"highly_reliable\", \"reliable\"].includes(data.factualRating);\n",
            "metric": "correct_rating"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"wire_service\" || data.sourceType === \"editorial_publisher\";\n",
            "metric": "correct_source_type"
          }
        ]
      },
      {
        "description": "Source with multiple documented fact-check failures",
        "vars": {
          "domain": "example-tabloid.net",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] PolitiFact (IFCN signatory, last 6 months): 8 claims reviewed, 6 rated False or Mostly False. Published fabricated quotes attributed to government officials.\n[E2] Snopes (IFCN signatory, last 12 months): Documented 5 instances of misleading headlines that directly contradict article content. Pattern of clickbait misinformation.\n[E3] Media Bias/Fact Check (current): Rated LOW for factual reporting. Failed 12 fact-checks in past 2 years. Questionable sources cited.\n[E4] NewsGuard (current): 35/100 rating. Fails to gather and present information responsibly. Does not regularly correct errors.\n"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.0 && data.score <= 0.42;\n",
            "metric": "score_capped_correctly"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn [\"unreliable\", \"leaning_unreliable\", \"highly_unreliable\"].includes(data.factualRating);\n",
            "metric": "correct_rating"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.confidence >= 0.50;\n",
            "metric": "adequate_confidence"
          }
        ]
      },
      {
        "description": "State-controlled media outlet - score must be capped",
        "vars": {
          "domain": "state-news-agency.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Reporters Without Borders: Classified as state-controlled media. No editorial independence from government.\n[E2] EU DisinfoLab: Content consistently reflects government narratives without critical coverage.\n[E3] Freedom House: Media outlet directly controlled by Ministry of Information.\n[E4] Academic study (last 18 months): Analysis shows 98% alignment with official government positions.\n"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"state_controlled_media\";\n",
            "metric": "correct_source_type"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.42;\n",
            "metric": "score_capped_at_042"
          }
        ]
      },
      {
        "description": "Known propaganda outlet - score must be capped at 0.14",
        "vars": {
          "domain": "propaganda-network.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] EU EUvsDisinfo: Listed in database of pro-Kremlin disinformation outlets.\n[E2] US State Department: Identified as part of coordinated influence operation.\n[E3] Stanford Internet Observatory: Documented as amplifying state propaganda narratives.\n[E4] NewsGuard: 0/100 rating. Publishes false content and does not disclose ownership.\n"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.sourceType === \"propaganda_outlet\" || data.sourceType === \"known_disinformation\";\n",
            "metric": "correct_source_type"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score <= 0.14;\n",
            "metric": "score_capped_at_014"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"highly_unreliable\";\n",
            "metric": "correct_rating"
          }
        ]
      },
      {
        "description": "Unknown source with sparse evidence - should return insufficient_data",
        "vars": {
          "domain": "unknown-local-blog.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Directory listing: Small local blog, no additional information available.\n"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.score === null;\n",
            "metric": "null_score"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.factualRating === \"insufficient_data\";\n",
            "metric": "insufficient_data_rating"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.confidence < 0.50;\n",
            "metric": "low_confidence"
          }
        ]
      },
      {
        "description": "Politically biased source with good accuracy - bias alone should not cap score",
        "vars": {
          "domain": "partisan-news.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Media Bias/Fact Check: Rated HIGH for factual reporting. Strong left-center bias but accurate.\n[E2] AllSides: Left bias rating, but described as \"factually reliable\".\n[E3] NewsGuard: 82/100 rating. Gathers and presents information responsibly despite perspective.\n[E4] PolitiFact: Reviewed 20 claims in past 18 months, only 2 rated as misleading.\n"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.score !== null && data.score >= 0.58;\n",
            "metric": "score_not_penalized_for_bias"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn data.bias && data.bias.politicalBias !== \"center\";\n",
            "metric": "bias_noted"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nreturn [\"reliable\", \"leaning_reliable\", \"highly_reliable\"].includes(data.factualRating);\n",
            "metric": "correct_rating"
          }
        ]
      },
      {
        "description": "All claims must cite evidence IDs (E1, E2, etc.)",
        "vars": {
          "domain": "test-citation-source.example",
          "currentDate": "2026-01-25",
          "evidencePack": "[E1] Fact-checker A: Rates source as generally reliable with good editorial standards.\n[E2] Fact-checker B: Confirms accurate reporting in recent review.\n[E3] Academic analysis: Source cited frequently in peer-reviewed research.\n"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "const data = JSON.parse(output);\nif (!data.evidenceCited || data.evidenceCited.length === 0) return false;\nreturn data.evidenceCited.every(e => /E\\d+/.test(e.basis));\n",
            "metric": "evidence_cited_correctly"
          }
        ]
      }
    ],
    "scenarios": [],
    "env": {},
    "sharing": false,
    "defaultTest": {
      "options": {
        "timeout": 60000,
        "transform": "let cleaned = output;\nconst match = output.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\nif (match) {\n  cleaned = match[1].trim();\n}\nreturn cleaned;\n"
      },
      "vars": {},
      "assert": [],
      "metadata": {}
    },
    "outputPath": [
      "./prompts/promptfoo-results/source-reliability.json"
    ],
    "extensions": [],
    "metadata": {},
    "evaluateOptions": {}
  },
  "shareableUrl": null,
  "metadata": {
    "promptfooVersion": "0.120.17",
    "nodeVersion": "v24.12.0",
    "platform": "win32",
    "arch": "x64",
    "exportedAt": "2026-01-26T06:23:04.641Z",
    "evaluationCreatedAt": "2026-01-26T06:23:03.909Z"
  }
}