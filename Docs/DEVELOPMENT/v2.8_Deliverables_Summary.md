# v2.8 Implementation Plan - Deliverables Summary

**Created:** 2026-01-19  
**Purpose:** Senior Developer implementation guide for UI transparency improvements

---

## üì¶ Deliverables

Three comprehensive documents have been created to guide implementation:

### 1. **Full Implementation Plan** (PRIMARY)
**File:** `Docs/DEVELOPMENT/v2.8_EvidenceScope_Implementation_Plan.md`  
**Size:** ~1,200 lines  
**Use:** Day-to-day implementation reference

**Contents:**
- Executive summary with effort estimates
- **CRITICAL section on pipeline compatibility**
- Feature descriptions with before/after examples
- 5 major tasks with detailed subtasks
- Complete code snippets for all components
- CSS styling for all new components
- Testing plan (unit, integration, E2E)
- Implementation checklist
- Risk assessment
- Success metrics

**Key Sections:**
- Pipeline Support Matrix (lines 41-64)
- Task 1: EvidenceScope Tooltips (lines 117-259)
- Task 2: Methodology Sub-Grouping (lines 261-486)
- Task 3: ArticleFrame LLM Guidance (lines 488-656)
- Task 4: ArticleFrame UI Display (lines 658-783)
- Testing Plan (lines 846-1089)

---

### 2. **Quick Reference Summary**
**File:** `Docs/DEVELOPMENT/v2.8_Implementation_Summary.md`  
**Size:** ~300 lines  
**Use:** Quick lookups, onboarding

**Contents:**
- Executive summary (TL;DR)
- Pipeline data structure differences (critical!)
- Feature compatibility matrix
- New files to create (list)
- Files to modify (list)
- Key code snippets (copy-paste ready)
- Testing strategy
- Common pitfalls to avoid (‚ùå vs ‚úÖ)
- 7-day timeline with milestones

**Best For:**
- Understanding scope quickly
- Checking pipeline compatibility
- Copying code snippets
- Avoiding common mistakes

---

### 3. **Validation Checklist**
**File:** `Docs/DEVELOPMENT/v2.8_Validation_Checklist.md`  
**Size:** ~600 lines  
**Use:** QA, pre-commit verification

**Contents:**
- Pre-implementation setup verification
- Component creation validation (per component)
- Integration validation (per integration point)
- Prompt updates validation (per file)
- Unit test validation
- E2E testing (4 test cases, all pipelines)
- Accessibility testing (keyboard, screen reader)
- Mobile testing (3 viewports)
- Dark mode testing
- Documentation validation
- Code quality checks
- Performance checks
- Regression testing
- Sign-off checklist

**Best For:**
- Ensuring nothing is missed
- Pre-commit verification
- Code review preparation
- QA testing

---

## üéØ Implementation Approach

### Recommended Reading Order

1. **Start:** Read `v2.8_Implementation_Summary.md` (15 min)
   - Understand scope and pipeline differences
   - Review data structure differences
   - Note common pitfalls

2. **Deep Dive:** Read `v2.8_EvidenceScope_Implementation_Plan.md` (45 min)
   - Understand each task in detail
   - Review code snippets
   - Plan your approach

3. **During Implementation:** Use both documents
   - Summary for quick reference
   - Full plan for detailed code

4. **Before Commit:** Use `v2.8_Validation_Checklist.md`
   - Check off each item
   - Test all three pipelines
   - Verify accessibility and mobile

---

## ‚ö†Ô∏è CRITICAL SUCCESS FACTORS

### 1. Pipeline Compatibility

**The #1 reason this implementation could fail:**  
Assuming all pipelines use the same data structure.

**Reality:**
- **Orchestrated & Canonical:** Use `ExtractedFact[]` with `evidenceScope`
- **Dynamic:** Uses free-form JSON with `citations[]`

**Solution:**  
Always use conditional checks and fallback logic.

```typescript
// ‚úÖ GOOD
if (!context.facts || context.facts.length === 0) {
  return <div>No facts</div>;
}

// ‚ùå BAD
const groups = groupFactsByMethodology(context.facts); // CRASH if undefined!
```

### 2. Multi-Source Fallback for ArticleFrame

**Don't hardcode for one pipeline:**

```typescript
// ‚ùå BAD
const articleFrame = result.understanding.analysisContext;

// ‚úÖ GOOD
let articleFrame = null;
if (result?.understanding?.analysisContext) {
  articleFrame = result.understanding.analysisContext;
}
if (!articleFrame && result?.rawJson?.articleFrame) {
  articleFrame = result.rawJson.articleFrame;
}
```

### 3. Test ALL Three Pipelines

**Each feature must be tested with:**
- Orchestrated pipeline
- Monolithic canonical pipeline
- Monolithic dynamic pipeline

**Use the validation checklist's E2E tests (Test 1-4).**

---

## üìä Feature-Pipeline Matrix (Quick Reference)

| Feature | Files to Modify | Orchestrated | Canonical | Dynamic |
|---------|----------------|--------------|-----------|---------|
| **EvidenceScope Tooltips** | `page.tsx`, `EvidenceScopeTooltip.tsx` | ‚úÖ Full | ‚úÖ Full | ‚ö†Ô∏è Simplified |
| **Methodology Sub-Grouping** | `ClaimsGroupedByScope.tsx`, `methodologyGrouping.ts` | ‚úÖ Full | ‚úÖ Full | ‚ùå Skip |
| **ArticleFrame Banner** | `page.tsx`, `ArticleFrameBanner.tsx` | ‚úÖ Full | ‚úÖ Full | ‚úÖ Full |
| **LLM Prompts** | `understand-base.ts`, `dynamic-plan-base.ts` | ‚úÖ Update | ‚úÖ Update | ‚úÖ Update |

---

## üõ†Ô∏è New Files to Create (9 files)

```
apps/web/src/app/jobs/[id]/
  components/
    ‚úÖ EvidenceScopeTooltip.tsx
    ‚úÖ EvidenceScopeTooltip.module.css
    ‚úÖ EvidenceScopeTooltip.test.tsx
    ‚úÖ MethodologySubGroup.tsx
    ‚úÖ MethodologySubGroup.module.css
    ‚úÖ ArticleFrameBanner.tsx
    ‚úÖ ArticleFrameBanner.module.css
  utils/
    ‚úÖ methodologyGrouping.ts
    ‚úÖ methodologyGrouping.test.ts
```

---

## üìù Files to Modify (5 files)

```
apps/web/src/app/jobs/[id]/
  ‚úÖ page.tsx (3 locations)
  ‚úÖ components/ClaimsGroupedByScope.tsx

apps/web/src/lib/analyzer/prompts/base/
  ‚úÖ understand-base.ts
  ‚úÖ dynamic-plan-base.ts

Docs/
  ‚úÖ CHANGELOG.md
```

---

## üìÖ Suggested Timeline

**Total Effort:** 5-7 days for senior developer

| Day | Tasks | Deliverables |
|-----|-------|--------------|
| **Day 1** | Create EvidenceScopeTooltip, write tests | 2 files + 1 test |
| **Day 2** | Create MethodologySubGroup, write utils + tests | 4 files + 2 tests |
| **Day 3** | Integrate tooltips and grouping into UI | 2 modified files |
| **Day 4** | Create ArticleFrameBanner, integrate with multi-pipeline logic | 3 files |
| **Day 5** | Update LLM prompts (understand-base, dynamic-plan-base) | 2 modified files |
| **Day 6** | Testing: E2E all pipelines, accessibility, mobile | Test reports |
| **Day 7** | Documentation, code review prep, PR creation | PR ready |

---

## ‚úÖ Success Criteria

### Must Have (Blocking)
- [ ] EvidenceScope tooltips work on orchestrated & canonical pipelines
- [ ] Methodology grouping appears when 3+ methodologies (orchestrated & canonical)
- [ ] ArticleFrame banner works on ALL three pipelines
- [ ] Dynamic pipeline doesn't crash when facts are missing
- [ ] All unit tests pass
- [ ] All E2E tests pass (4 test cases)

### Nice to Have (Non-Blocking)
- [ ] Keyboard accessible (Tab + Enter)
- [ ] Mobile responsive (3 viewports)
- [ ] Dark mode support
- [ ] Smooth animations

### Must NOT (Critical Failures)
- [ ] Break existing functionality
- [ ] Crash on missing data structures
- [ ] Show tooltips when no data present
- [ ] Attempt methodology grouping on dynamic pipeline
- [ ] Hardcode for single pipeline

---

## üîó Related Documentation

**Analysis & Design:**
- `Docs/ARCHITECTURE/UI_Grouping_and_ArticleFrame_Analysis_2026-01-19.md`
- `Docs/REFERENCE/TERMINOLOGY.md`

**Architecture:**
- `Docs/ARCHITECTURE/Pipeline_TriplePath_Architecture.md`
- `Docs/DEVELOPMENT/TriplePath_Implementation_Complete.md`

**Prompts:**
- `Docs/DEVELOPMENT/LLM_Prompt_Improvements.md`

**Source Code (for reference):**
- Orchestrated: `apps/web/src/lib/analyzer.ts`
- Canonical: `apps/web/src/lib/analyzer/monolithic-canonical.ts`
- Dynamic: `apps/web/src/lib/analyzer/monolithic-dynamic.ts`

---

## üÜò Troubleshooting Guide

### Issue: "Cannot read property 'evidenceScope' of undefined"

**Cause:** Assuming all pipelines have `ExtractedFact[]`  
**Solution:** Add null check before accessing

```typescript
if (!fact || !fact.evidenceScope) return null;
```

### Issue: "ArticleFrame banner not showing on dynamic pipeline"

**Cause:** Only checking `result.understanding.analysisContext`  
**Solution:** Use multi-source fallback (see Summary doc, line 143)

### Issue: "Methodology grouping crashes on dynamic pipeline"

**Cause:** Dynamic pipeline has no `context.facts` array  
**Solution:** Add safety check (see Plan doc, line 435)

### Issue: "Tests fail with 'module not found'"

**Cause:** New files not added to git  
**Solution:** `git add` all new component files

### Issue: "TypeScript errors in prompt files"

**Cause:** Template literal syntax issues  
**Solution:** Check backticks and variable interpolation

---

## üìû Support & Questions

**Before asking:**
1. Check the Implementation Plan (most detailed)
2. Check the Summary (common issues)
3. Check the Validation Checklist (testing scenarios)

**Common Questions:**

**Q: Do I need to update the API (ASP.NET)?**  
A: No, this is UI-only. No backend changes required.

**Q: Do I need to update the database?**  
A: No, all data fields already exist. No migration needed.

**Q: What if ArticleFrame is never populated by the LLM?**  
A: That's expected. It's optional. Banner should hide gracefully.

**Q: Should I group methodologies with only 2 distinct values?**  
A: No. The grouping logic returns `null` when <3 methodologies, showing flat list instead.

**Q: Can I use a different UI library for tooltips?**  
A: Prefer the provided CSS-only solution for simplicity. Avoid adding dependencies.

---

## üé¨ Ready to Start?

1. **Read** `v2.8_Implementation_Summary.md` (15 min)
2. **Skim** `v2.8_EvidenceScope_Implementation_Plan.md` (30 min)
3. **Create branch:** `feature/v2.8-evidence-scope-display`
4. **Start with Day 1 tasks:** EvidenceScopeTooltip component
5. **Use Validation Checklist** as you complete each task

**Good luck! üöÄ**

---

**END OF DELIVERABLES SUMMARY**
