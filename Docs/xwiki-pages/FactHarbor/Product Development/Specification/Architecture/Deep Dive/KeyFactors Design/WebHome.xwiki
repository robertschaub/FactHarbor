= KeyFactors Design Decision =

{{info}}
**Developer Reference** — Design decisions around KeyFactors: decomposition questions that break down a thesis into verifiable dimensions. Covers entity relationships, data flow, contestation structure, and implementation status.

**Key File**: ##apps/web/src/lib/analyzer/orchestrated.ts## (KeyFactor discovery in Understanding phase)
{{/info}}

**Date**: January 2026
**Version**: 2.6.33
**Status**: Design Decision Document

----

== Executive Summary ==

This document captures the design decisions around **KeyFactors** in FactHarbor's fact-checking architecture:

1. **KeyFactors are decomposition questions** that break down a thesis into verifiable dimensions
1. **KeyFactors should be optional and emergent**, not forced templates
1. **KeyFactors are discovered during understanding**, not verdict generation
1. **Scenario was rejected** as a first-class entity (derivable from existing data)

----

== 1. What is a KeyFactor? ==

=== Definition ===

A **KeyFactor** is an **evaluation dimension** — a question that must be answered to verify a thesis. It represents a structured decomposition of "what must be true for the thesis to be true?"

=== Examples ===

|= Thesis |= KeyFactors (Decomposition Questions)
| "The Bolsonaro trial was fair" | Was due process followed? Was evidence properly considered? Was the judge impartial? Was the outcome proportionate?
| "Vaccine X causes autism" | Is there a documented causal mechanism? Do controlled studies support this? What does scientific consensus say?
| "Company Y committed fraud" | Were financial statements misrepresented? Was there intent to deceive? Were stakeholders harmed?

=== KeyFactor vs Claim ===

{{include reference="FactHarbor.Product Development.Diagrams.KeyFactor Hierarchy.WebHome"/}}

|= Entity |= Level |= What it represents
| **Thesis** | Highest | The main assertion to verify
| **KeyFactor** | Middle | Evaluation dimension / decomposition question
| **Claim** | Lowest | Atomic verifiable assertion

----

== 2. Entity Relationship Model ==

{{include reference="FactHarbor.Product Development.Diagrams.KeyFactor Entity Model.WebHome"/}}

----

== 3. Data Flow ==

{{include reference="FactHarbor.Product Development.Diagrams.KeyFactor Data Flow.WebHome"/}}

----

== 4. Design Decisions ==

=== Decision 1: KeyFactors are Optional and Emergent ===

**Rejected Approach**: Force a fixed template of 5 factors for every analysis.

**Adopted Approach**: KeyFactors emerge from thesis decomposition. The number and type depend on the specific claim being analyzed.

{{code language="typescript"}}
// BAD: Forced template
const FACTORS = ["Process", "Evidence", "Impartiality", "Proportionality", "Compliance"];

// GOOD: Emergent from thesis
const factors = await decomposeThesis(thesis);
// Could return 2 factors, 5 factors, or none
{{/code}}

**Rationale**:
* Different claims require different evaluation dimensions
* Forcing irrelevant factors creates noise
* LLM can identify what dimensions actually matter

**Optional Hints (v2.6.18+)**:
While KeyFactors remain emergent, you can optionally provide hints via ##FH_KEYFACTOR_HINTS## environment variable. These are **suggestions only** — the LLM can consider them but is not required to use them. This allows domain-specific guidance without enforcing irrelevant factors.

{{code language="bash"}}
# In .env.local or environment
FH_KEYFACTOR_HINTS='[{"question":"Was due process followed?","factor":"Due Process","category":"procedural"},{"question":"Was evidence properly considered?","factor":"Evidence Basis","category":"evidential"}]'
{{/code}}

=== Decision 2: KeyFactors are Discovered During Understanding ===

**Rejected Approach**: Generate KeyFactors during verdict generation.

**Adopted Approach**: Discover KeyFactors in Step 1 (Understand), so research can be directed toward answering them.

{{mermaid}}
flowchart LR
    subgraph "Understanding Phase"
        T[Thesis] --> KF[KeyFactors]
        KF --> C[Claims mapped to factors]
    end

    subgraph "Research Phase"
        C --> R[Research guided by factors]
    end

    subgraph "Verdict Phase"
        R --> V[Verdicts per factor]
    end
{{/mermaid}}

//KeyFactors guide the entire pipeline: discovered early so research and verdict phases benefit from the decomposition.//

**Rationale**:
* KeyFactors guide what evidence to search for
* Claims should be organized by the factor they address
* Verdict is aggregation, not discovery

=== Decision 3: Scenario Rejected as First-Class Entity ===

**Rejected**: Creating a ##Scenario## entity to represent competing narratives.

**Rationale**:
* Scenarios are derivable from existing data (contestation metadata)
* Adding Scenario increases schema complexity
* Risk of creating false equivalence between well-supported and poorly-supported interpretations
* Contestation already captures "who disputes what"

**Alternative**: Display "Competing Interpretations" as a derived view when relevant.

=== Decision 4: KeyFactor Contestation Structure ===

Contestation attaches to KeyFactors (not Claims) because:
* Political disputes are usually about evaluation dimensions ("was it fair?")
* Not about atomic facts ("court met on date X")

{{code language="typescript"}}
// KeyFactor verdict (per AnalysisContextAnswer) — types.ts
interface KeyFactor {
  factor: string;                // Short label (matches KEY_FACTOR_DEF.factor)
  supports: "yes" | "no" | "neutral";
  explanation: string;

  // Contestation
  isContested: boolean;
  contestedBy: string;           // e.g. "stakeholder group", "opposition coalition"
  contestationReason: string;    // Why the finding is contested
  factualBasis: "established" | "disputed" | "opinion" | "unknown";
}
{{/code}}

**factualBasis Rules (v2.8 — Affects Weight Calculation):**

|= Value |= Meaning |= Weight |= Example
| ##established## | Strong documented counter-evidence | 0.3x | Court transcripts showing bias
| ##disputed## | Some factual counter-evidence | 0.5x | Conflicting expert opinions
| ##opinion## | No factual counter-evidence (DOUBTED) | 1.0x | "Critics say it was unfair"
| ##alleged## | Accusation without evidence (DOUBTED) | 1.0x | Political statements
| ##unknown## | Cannot determine | 1.0x | Insufficient information

**Key Distinction (v2.8):**
* **DOUBTED** (##opinion##/##alleged##/##unknown##): Political rhetoric without evidence -> Full weight
* **CONTESTED** (##established##/##disputed##): Has documented counter-evidence -> Reduced weight

----

== 5. Relationship to Claims ==

{{include reference="FactHarbor.Product Development.Diagrams.KeyFactor Claim Mapping.WebHome"/}}

//Blue = KeyFactors (evaluation dimensions). Orange = Claims (atomic verifiable assertions). Each factor is answered by one or more claims.//

**KeyFactor verdict** = Aggregation of claim verdicts that address that factor.

----

== 6. Implementation Status ==

|= Feature |= Status |= Notes
| Discovery in Understanding | Complete | Schema includes ##keyFactors## array
| Emergent factors | Complete | No forced template
| Optional hints | Complete | ##FH_KEYFACTOR_HINTS## env var provides suggestions (not enforced)
| Claim-to-factor mapping | Complete | ##keyFactorId## preserved in ##ClaimVerdict## (fixed 2026-01-06)
| Factor aggregation | Fixed | Aggregation logic finds mapped claims (validation needed)
| Report display | Complete | Both question and article modes
| Contestation | Partial | Schema supports it but not fully implemented

----

== Summary ==

|= Aspect |= Decision
| **What is KeyFactor?** | Evaluation dimension / decomposition question
| **When discovered?** | During Understanding phase
| **Required?** | No — optional, 0-N per analysis
| **Fixed template?** | No — emergent from thesis
| **Optional hints?** | Yes — ##FH_KEYFACTOR_HINTS## provides suggestions (not enforced)
| **Contestation?** | Attaches to KeyFactors
| **Scenario entity?** | Rejected — derivable from contestation
| **Relationship to Claims** | Parent-child (factor answered by claims)

----

== Related Documentation ==

* [[Calculations and Verdicts>>FactHarbor.Product Development.Specification.Architecture.Deep Dive.Calculations and Verdicts.WebHome]] — Verdict aggregation including KeyFactor-level verdicts
* [[Data Model>>FactHarbor.Product Development.Specification.Architecture.Data Model.WebHome]] — Entity relationships
* [[Orchestrated Pipeline>>FactHarbor.Product Development.Specification.Architecture.Deep Dive.Orchestrated Pipeline.WebHome]] — Pipeline flow where KeyFactors are discovered

----

**Navigation:** [[Deep Dive Index>>FactHarbor.Product Development.Specification.Architecture.Deep Dive.WebHome]]
