= AKEL Pipeline =

The **AI Knowledge Extraction Layer (AKEL)** is FactHarbor's core analysis engine. It takes an article or claim as input and produces a structured verdict report through a 5-step process: Understand, Research, Verdict, Summary, and Report.

== Pipeline Overview ==

{{include reference="FactHarbor.Product Development.Diagrams.AKEL Pipeline Detail.WebHome"/}}

=== Step-by-Step ===

**Step 1: Understand** — Analyses the input to determine what needs checking.
* Detects input type: question, statement, or article
* Extracts individual claims with dependency chains
* Identifies analysis contexts (bounded analytical frames for multi-perspective topics)
* Assigns risk tiers (A=high, B=medium, C=low) to guide research depth
* Applies **Gate 1** (Claim Validation): filters opinions, predictions, and non-factual statements

**Step 2: Research** — Iteratively searches the web for evidence.
* Generates targeted search queries based on claims and gaps
* Fetches and parses source content (HTML via cheerio, PDF via pdf2json)
* Extracts evidence items from each source (statements, statistics, expert quotes)
* Applies evidence quality filtering (probative value, deduplication, provenance)
* Repeats until research is complete or iteration/token budget is exhausted (default: 5 iterations, 750K tokens)

**Step 3: Verdict** — Evaluates each claim against the evidence.
* Generates per-claim verdicts on the 7-point scale (TRUE → FALSE)
* Propagates dependency failures (if prerequisite claim fails, dependent claims inherit)
* Aggregates claim verdicts into an overall article verdict using weighted averages (centrality, harm potential, evidence quality, source reliability)
* Applies **Gate 4** (Confidence Assessment): flags low-confidence verdicts

**Step 4: Summary** — Structures results for presentation.
* Builds a two-panel summary (Overview + Key Findings)

**Step 5: Report** — Generates the final output.
* Produces a markdown report with all sections: Summary, Claims, Sources, Verdict

== Pipeline Variants ==

FactHarbor supports two pipeline variants. The **ClaimAssessmentBoundary** pipeline is the comprehensive default; the **monolithic dynamic** variant is a fast, lower-cost alternative.

{{mermaid}}
flowchart LR
    INPUT["User Input"] --> DISPATCH{{"Pipeline\nDispatch"}}

    DISPATCH -->|"claimboundary\n(default)"| CB["ClaimAssessmentBoundary\n5-stage workflow\nFull quality gates"]
    DISPATCH -->|"monolithic_dynamic"| DYN["Monolithic Dynamic\nSingle LLM call\nFlexible output"]

    CB --> RESULT["AnalysisResult\nJSON"]
    DYN --> RESULT

    style CB fill:#c8e6c9,stroke:#2e7d32,color:#000
    style DYN fill:#f3e5f5,stroke:#6a1b9a,color:#000
{{/mermaid}}

//Both variants produce an AnalysisResult JSON output. The ClaimAssessmentBoundary pipeline is the default and most capable; the monolithic dynamic variant trades depth for speed and flexibility.//

|= Variant |= Approach |= Quality |= Speed |= Use Case
| **ClaimAssessmentBoundary** | 5-stage workflow (extract → research → cluster → verdict → aggregate) with iterative research, quality gates, evidence filtering | Highest | Thorough (multiple LLM calls) | Production analysis
| **Monolithic Dynamic** | Single LLM tool-loop call, flexible output | Streamlined | Fastest | Fast analysis, second opinion

== Shared Analysis Modules ==

All pipeline variants share a common set of analysis modules. This ensures consistency in verdict calculations, evidence quality, and source reliability across pipelines.

{{include reference="FactHarbor.Product Development.Diagrams.AKEL Shared Modules.WebHome"/}}

|= Module |= Used By |= Purpose
| ##aggregation.ts## | CB | Verdict weighting by centrality/harm/confidence/triangulation, contestation weight reduction
| ##claim-decomposition.ts## | CB | Claim text parsing and normalisation
| ##evidence-filter.ts## | CB | Probative value filtering, false positive rate calculation
| ##quality-gates.ts## | CB | Gate 1 (claim fidelity + specificity) and Gate 4 (verdict confidence)
| ##source-reliability.ts## | CB, Dyn | LLM-based source credibility evaluation with SQLite cache
| ##truth-scale.ts## | CB, Dyn | Percentage-to-verdict label mapping (7-point scale)
| ##budgets.ts## | CB, Dyn | Token and cost budget tracking and enforcement

== Budget Controls ==

The ClaimAssessmentBoundary pipeline enforces budgets to prevent runaway LLM costs:

|= Budget |= Default |= Purpose
| Max research iterations | 3 per boundary | Limits research rounds per ClaimAssessmentBoundary
| Max total tokens | 750,000 | Caps total LLM token consumption across all stages
| Max boundaries | UCM-configurable | Hard limit on ClaimAssessmentBoundaries processed in parallel

== Deep Dives ==

For detailed implementation references:
* [[Pipeline Variants>>FactHarbor.Product Development.Specification.Architecture.Deep Dive.Pipeline Variants.WebHome]] — CB pipeline (5 stages) and Monolithic Dynamic: invariants, shared primitives, result model
* [[Quality Gates>>FactHarbor.Product Development.Specification.Architecture.Deep Dive.Quality Gates.WebHome]] — Gate 1 (claim fidelity) and Gate 4 (verdict confidence) criteria, configuration

----

**Navigation:** [[Architecture>>FactHarbor.Product Development.Specification.Architecture.WebHome]] | Prev: [[System Design>>FactHarbor.Product Development.Specification.Architecture.System Design.WebHome]] | Next: [[Data Model>>FactHarbor.Product Development.Specification.Architecture.Data Model.WebHome]]
