= Architecture =

FactHarbor's architecture is designed for **simplicity, automation, and continuous improvement**. This page provides an overview with key diagrams; child pages contain detailed documentation.

== Core Principles ==

* **AI-First**: AKEL (AI) is the primary system, humans supplement
* **Publish by Default**: No centralized approval, publish with confidence scores
* **System Over Data**: Fix algorithms, not individual outputs
* **Measure Everything**: Quality metrics drive improvements
* **Scale Through Automation**: Minimal human intervention
* **Start Simple**: Add complexity only when metrics prove necessary

See [[Design Decisions>>FactHarbor.Specification.Design-Decisions]] and [[When to Add Complexity>>FactHarbor.Specification.When-to-Add-Complexity]] for detailed rationale.

== System Architecture ==

{{include reference="FactHarbor.Specification.Diagrams.High-Level Architecture.WebHome"/}}

FactHarbor uses a **two-service architecture**:

* **.NET API (apps/api)** — ASP.NET Core 8.0, SQLite, job persistence, status tracking, SSE events
* **Next.js Web App (apps/web)** — Next.js 14+ (TypeScript, React), UI and analysis engine

The system follows a three-layer design:

* **Interface Layer**: Web UI, REST API, real-time SSE updates
* **Processing Layer**: AKEL pipeline (AI-driven claim analysis), LLM abstraction, quality gates
* **Data & Storage Layer**: SQLite (current), PostgreSQL + Redis + S3 (planned for production)

See [[Architecture Summary>>FactHarbor.Specification.Architecture.Architecture Summary.WebHome]] for component details and shared modules. See [[System Components>>FactHarbor.Specification.Architecture.System Components.WebHome]] for interaction diagrams and key files.

== AKEL Pipeline ==

{{include reference="FactHarbor.Specification.Diagrams.AKEL Architecture.WebHome"/}}

The AI Knowledge Extraction Layer (AKEL) is the core analysis engine. It supports three pipeline variants (Orchestrated, Monolithic Canonical, Monolithic Dynamic) with shared modules for evidence filtering, verdict corrections, and source reliability.

See [[AI Knowledge Extraction Layer (AKEL)>>FactHarbor.Specification.AI Knowledge Extraction Layer (AKEL).WebHome]] for the full specification. See [[AKEL Pipeline Flow>>FactHarbor.Specification.Implementation.AKEL Pipeline Flow.WebHome]] for the step-by-step implementation flow.

== Data Architecture ==

{{include reference="FactHarbor.Specification.Diagrams.Core Data Model ERD.WebHome"/}}

The analysis result model centres on: ARTICLE → CLAIM → CLAIM_VERDICT → EVIDENCE_ITEM → SOURCE, with AnalysisContexts and KeyFactors providing structured decomposition. See [[Data Models>>FactHarbor.Specification.Architecture.Data Models.WebHome]] for entity details and the job lifecycle model.

{{include reference="FactHarbor.Specification.Diagrams.Storage Architecture.WebHome"/}}

Current implementation uses SQLite across three databases (factharbor.db, config.db, source-reliability.db). Production target: PostgreSQL (primary), Redis (caching), S3 (archival).

{{include reference="FactHarbor.Specification.Diagrams.Versioning Architecture.WebHome"/}}

Configuration uses content-addressed immutable blobs with activation pointers, enabling reproducible analysis runs.

== LLM Integration ==

{{include reference="FactHarbor.Specification.Diagrams.LLM Abstraction Architecture.WebHome"/}}

FactHarbor uses a provider-agnostic abstraction layer via the **Vercel AI SDK** for all AI interactions:

* **Providers**: Anthropic (Claude), OpenAI (GPT), Google (Gemini), Mistral (fallback to Anthropic)
* **Model Tiering**: Separate models per pipeline phase — budget models for extraction, premium for analysis
* **Configuration**: Runtime model switching via UCM Admin UI (##modelUnderstand##, ##modelExtractEvidence##, ##modelVerdict##)
* **Failover**: Automatic fallback with circuit breaker pattern
* **No Vendor Lock-In**: Switch providers based on cost, quality, or availability without code changes

See [[LLM Abstraction Layer>>FactHarbor.Specification.POC.API-and-Schemas.LLM Abstraction Layer.WebHome]] for implementation details. See [[Design Decisions §9>>FactHarbor.Specification.Design-Decisions#Section-9]] for rationale.

== Technology Stack ==

**Current Implementation:**
* ASP.NET Core 8.0 (C#) — API backend with SQLite
* Next.js 14+ (TypeScript, React, CSS Modules) — Web application
* Vercel AI SDK — Multi-provider LLM support (Anthropic, OpenAI, Google, Mistral)
* UCM (Unified Config Management) — Runtime configuration

**Target Production Stack** (planned):
* PostgreSQL (primary database), Redis (caching), S3 (archival storage)
* Docker containers, Kubernetes or cloud auto-scaling
* Prometheus + Grafana for monitoring

== Detailed Architecture ==

* [[Architecture Summary>>FactHarbor.Specification.Architecture.Architecture Summary.WebHome]] — Components, shared analyzer modules, security model
* [[System Components>>FactHarbor.Specification.Architecture.System Components.WebHome]] — Interaction diagram, key files, UCM architecture
* [[Data Models>>FactHarbor.Specification.Architecture.Data Models.WebHome]] — ERD, entity details, job lifecycle data model
* [[Target Production Architecture>>FactHarbor.Specification.Architecture.Target Production.WebHome]] — Scalability, security, deployment, monitoring, future evolution

== Related ==

* [[AI Knowledge Extraction Layer (AKEL)>>FactHarbor.Specification.AI Knowledge Extraction Layer (AKEL).WebHome]]
* [[Data Model (Specification)>>FactHarbor.Specification.Data Model.WebHome]]
* [[Design Decisions>>FactHarbor.Specification.Design-Decisions]]
* [[When to Add Complexity>>FactHarbor.Specification.When-to-Add-Complexity]]
* [[Implementation>>FactHarbor.Specification.Implementation.WebHome]] — Pipeline details, source reliability, quality gates
