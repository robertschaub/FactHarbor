{{info}}
**Current Implementation** - The default pipeline with TypeScript-orchestrated staged workflow. File: ##orchestrated.ts## (~13,300 lines)

Updated 2026-02-08 per documentation audit report.
{{/info}}

= Orchestrated Pipeline Internal Flow =

{{mermaid}}

flowchart TB
    subgraph Entry[Entry Point]
        INPUT[runFactHarborAnalysis]
        NORM[Input Normalization]
        BUDGET[Initialize Budget Tracker]
    end

    subgraph Step1[Step 1: Understand]
        UC[understandClaim]
        LLM1[LLM Call]
        SCOPE[detectContexts heuristic]
        CLAIMS[Extract SubClaims]
        QUERIES[Generate researchQueries]
    end

    subgraph Step2[Step 2: Research Loop]
        DECIDE[decideNextResearch]
        SEARCH[searchWebWithProvider]
        FETCH[fetchSourceContent parallel]
        PREFILTER[Relevance Pre-Filter]
        ADAPTIVE{Candidates >= 5?}
        FALLBACK[Adaptive Fallback: relax constraints + extra queries]
        EXTRACT[extractEvidence per source]
        LLM2[LLM Calls]
        BUDGET_CHECK{Budget exceeded?}
    end

    subgraph Step3[Step 3: Verdict Generation]
        CLAIM_V[generateClaimVerdicts]
        ARTICLE_V[generateArticleVerdict]
        LLM3[LLM Call]
        WEIGHT[calculateWeightedVerdictAverage]
        CONTEST[detectClaimContestation]
        HARM[detectHarmPotential]
    end

    subgraph Step4[Step 4: Summary]
        SUMMARY[generateTwoPanelSummary]
    end

    subgraph Step5[Step 5: Report]
        REPORT[generateReport markdown]
    end

    subgraph Output[Output]
        RESULT[AnalysisResult JSON]
        MARKDOWN[Report Markdown]
    end

    INPUT --> NORM
    NORM --> BUDGET
    BUDGET --> UC

    UC --> LLM1
    LLM1 --> SCOPE
    SCOPE --> CLAIMS
    CLAIMS --> QUERIES

    QUERIES --> DECIDE
    DECIDE --> SEARCH
    SEARCH --> FETCH
    FETCH --> PREFILTER
    PREFILTER --> ADAPTIVE
    ADAPTIVE -- Yes --> EXTRACT
    ADAPTIVE -- No --> FALLBACK
    FALLBACK --> EXTRACT
    EXTRACT --> LLM2
    LLM2 --> BUDGET_CHECK
    BUDGET_CHECK -->|No| DECIDE
    BUDGET_CHECK -->|Yes| CLAIM_V

    CLAIM_V --> WEIGHT
    WEIGHT --> CONTEST
    CONTEST --> HARM
    HARM --> ARTICLE_V
    ARTICLE_V --> LLM3

    LLM3 --> SUMMARY
    SUMMARY --> REPORT
    REPORT --> RESULT
    REPORT --> MARKDOWN

{{/mermaid}}

= Key Functions =

|= Phase |= Function |= Purpose |= LLM Calls
| Entry | ##runFactHarborAnalysis## | Main entry point | 0
| Entry | ##normalizeYesNoQuestionToStatement## | Input neutrality normalization | 0
| Step 1 | ##understandClaim## | Claim extraction and classification | 1
| Step 1 | ##detectContexts## | Heuristic context pre-detection | 0
| Step 2 | ##decideNextResearch## | Generate search queries | 1 per iteration
| Step 2 | ##searchWebWithProvider## | Web search (Google CSE or SerpAPI) | 0
| Step 2 | ##fetchSourceContent## | Parallel source fetching | 0
| Step 2 | ##buildAdaptiveFallbackQueries## | Relax constraints when candidates < threshold | 0
| Step 2 | ##extractEvidence## | Extract evidence from sources | 1 per source
| Step 3 | ##generateClaimVerdicts## | Per-claim verdicts | 1
| Step 3 | ##generateArticleVerdict## | Overall verdict | 1
| Step 4 | ##generateTwoPanelSummary## | Format results for UI | 0
| Step 5 | ##generateReport## | Markdown report generation | 0

= Budget Controls =

|= Parameter |= Default |= Config Property
| Max iterations per context | 5 | ##maxIterationsPerContext##
| Max total iterations | 20 | ##maxTotalIterations##
| Max total tokens | 750000 | ##maxTotalTokens##

= Adaptive Fallback Parameters =

|= Parameter |= Default |= Config Property
| Min candidates before fallback | 5 | ##searchAdaptiveFallbackMinCandidates##
| Max extra fallback queries | 2 | ##searchAdaptiveFallbackMaxQueries##

= Shared Modules Used =

* ##analysis-contexts.ts## - detectContexts, canonicalizeContexts
* ##aggregation.ts## - calculateWeightedVerdictAverage, detectClaimContestation, detectHarmPotential
* ##claim-decomposition.ts## - normalizeClaimText, deriveCandidateClaimTexts
* ##budgets.ts## - Budget tracking and enforcement
* ##evidence-filter.ts## - Probative value filtering, false positive rate
* ##quality-gates.ts## - Gate 1 (claim validation), Gate 4 (verdict confidence)
* ##source-reliability.ts## - LLM-based source reliability with cache
* ##verdict-corrections.ts## - Post-hoc verdict direction mismatch corrections

= Output Schema =

Produces **canonical schema** compatible with existing Jobs UI:
* ##article## - Input metadata, thesis, analysisContexts
* ##claims## - Array of extracted claims with dependencies
* ##claimVerdicts## - Per-claim verdicts with truthPercentage
* ##articleVerdict## - Overall verdict
* ##evidenceItems## - Extracted evidence from sources
* ##sources## - Source metadata with reliability scores
