{{info}}
**Current Implementation (v2.10.2)** - Two-service architecture: Next.js web app for UI and analysis, .NET API for job persistence.
{{/info}}

= High-Level Architecture =

{{mermaid}}

graph TB
    subgraph Client[Client Layer]
        BROWSER[Web Browser]
    end

    subgraph NextJS[Next.js Web App]
        ANALYZE[analyze page]
        JOBS[jobs page]
        JOBVIEW[jobs id page]
        ANALYZE_API[api fh analyze]
        JOBS_API[api fh jobs]
        RUN_JOB[api internal run-job]
        ORCH[orchestrated.ts]
        CANON[monolithic-canonical.ts]
        SHARED[Shared Modules]
        WEBSEARCH[web-search.ts]
        SR[source-reliability.ts]
    end

    subgraph DotNet[.NET API]
        DOTNET_API[ASP.NET Core API]
        JOBS_CTRL[JobsController]
        HEALTH_CTRL[HealthController]
        SQLITE[(SQLite factharbor.db)]
    end

    subgraph External[External Services]
        LLM[LLM Providers]
        SEARCH[Search Providers]
    end

    BROWSER --> ANALYZE
    BROWSER --> JOBS
    BROWSER --> JOBVIEW
    ANALYZE --> ANALYZE_API
    ANALYZE_API --> DOTNET_API
    DOTNET_API --> SQLITE
    RUN_JOB --> ORCH
    RUN_JOB --> CANON
    ORCH --> SHARED
    CANON --> SHARED
    ORCH --> LLM
    CANON --> LLM
    ORCH --> WEBSEARCH
    WEBSEARCH --> SEARCH
    SHARED --> SR

{{/mermaid}}

== Component Summary ==

|= Component |= Technology |= Purpose
| **Web App** | Next.js 14+ | UI, API routes, AKEL pipeline
| **API** | ASP.NET Core 8.0 | Job persistence, health checks
| **Database** | SQLite (3 databases) | Jobs/events, UCM config, SR cache
| **LLM** | AI SDK (Vercel) | Multi-provider LLM abstraction with model tiering
| **Search** | Google CSE / SerpAPI | Web search for evidence

== Key Files ==

|= File |= Lines |= Purpose
| ##orchestrated.ts## | ~13300 | Main orchestrated pipeline
| ##monolithic-canonical.ts## | ~1500 | Monolithic canonical pipeline
| ##analysis-contexts.ts## | ~600 | AnalysisContext pre-detection
| ##aggregation.ts## | ~400 | Verdict aggregation + claim weighting
| ##evidence-filter.ts## | ~300 | Deterministic evidence quality filtering
| ##source-reliability.ts## | ~500 | LLM-based source reliability scoring

== Environment Variables ==

|= Variable |= Default |= Purpose
| ##FH_SEARCH_ENABLED## | true | Enable web search
| ##FH_DETERMINISTIC## | true | Zero temperature
| ##FH_API_URL## | localhost:5139 | .NET API endpoint